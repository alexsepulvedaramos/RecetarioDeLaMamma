import{P as Va,a as jn,b as Da,d as p,e as fe,f as pi,h as Gn,j as xa}from"./chunk-274D6EXY.js";var ka=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},oh=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=e[n++],o=e[n++],a=e[n++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return t.join("")},Oa={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){let s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,u=c?e[i+2]:0,l=s>>2,h=(s&3)<<4|a>>4,d=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(d=64)),r.push(n[l],n[h],n[d],n[m])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(ka(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):oh(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){let s=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0;++i;let u=i<e.length?n[e.charAt(i)]:64;++i;let h=i<e.length?n[e.charAt(i)]:64;if(++i,s==null||a==null||u==null||h==null)throw new _i;let d=s<<2|a>>4;if(r.push(d),u!==64){let m=a<<4&240|u>>2;if(r.push(m),h!==64){let A=u<<6&192|h;r.push(A)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},_i=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},ah=function(e){let t=ka(e);return Oa.encodeByteArray(t,!0)},Ge=function(e){return ah(e).replace(/\./g,"")},ch=function(e){try{return Oa.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function uh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var lh=()=>uh().__FIREBASE_DEFAULTS__,hh=()=>{if(typeof process>"u"||typeof process.env>"u")return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},dh=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=e&&ch(e[1]);return t&&JSON.parse(t)},yi=()=>{try{return lh()||hh()||dh()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},fh=e=>{var t,n;return(n=(t=yi())===null||t===void 0?void 0:t.emulatorHosts)===null||n===void 0?void 0:n[e]},Ma=e=>{let t=fh(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return t[0]==="["?[t.substring(1,n-1),r]:[t.substring(0,n),r]},wi=()=>{var e;return(e=yi())===null||e===void 0?void 0:e.config};var $n=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}wrapCallback(t){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(n):t(n,r))}}};function La(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Ge(JSON.stringify(n)),Ge(JSON.stringify(o)),""].join(".")}function Ke(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mh(){var e;let t=(e=yi())===null||e===void 0?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Fa(){return!mh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Kn(){try{return typeof indexedDB=="object"}catch{return!1}}function Ba(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;t(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){t(n)}})}var gh="FirebaseError",Rt=class e extends Error{constructor(t,n,r){super(n),this.code=t,this.customData=r,this.name=gh,Object.setPrototypeOf(this,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$e.prototype.create)}},$e=class{constructor(t,n,r){this.service=t,this.serviceName=n,this.errors=r}create(t,...n){let r=n[0]||{},i=`${this.service}/${t}`,s=this.errors[t],o=s?ph(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Rt(i,a,r)}};function ph(e,t){return e.replace(_h,(n,r)=>{let i=t[r];return i!=null?String(i):`<${r}?>`})}var _h=/\{\$([^}]+)}/g;function Qe(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let s=e[i],o=t[i];if(Na(s)&&Na(o)){if(!Qe(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!n.includes(i))return!1;return!0}function Na(e){return e!==null&&typeof e=="object"}var sg=4*60*60*1e3;function Pt(e){return e&&e._delegate?e._delegate:e}var Ct=class{constructor(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var Kt="[DEFAULT]";var vi=class{constructor(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){let r=new $n;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(t){var n;let r=this.normalizeInstanceIdentifier(t?.identifier),i=(n=t?.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(wh(t))try{this.getOrInitializeService({instanceIdentifier:Kt})}catch{}for(let[n,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(n);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(t=Kt){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return p(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...t.filter(n=>"_delete"in n).map(n=>n._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=Kt){return this.instances.has(t)}getOptions(t=Kt){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:n={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(t,n){var r;let i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(t),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&t(o,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,n){let r=this.onInitCallbacks.get(n);if(r)for(let i of r)try{i(t,n)}catch{}}getOrInitializeService({instanceIdentifier:t,options:n={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:yh(t),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Kt){return this.component?this.component.multipleInstances?t:Kt:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function yh(e){return e===Kt?void 0:e}function wh(e){return e.instantiationMode==="EAGER"}var Qn=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let n=this.getProvider(t.name);if(n.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);n.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let n=new vi(t,this);return this.providers.set(t,n),n}getProviders(){return Array.from(this.providers.values())}};var vh=[],D=function(e){return e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",e}(D||{}),Eh={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},Ih=D.INFO,Th={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},Ah=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=Th[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},me=class{constructor(t){this.name=t,this._logLevel=Ih,this._logHandler=Ah,this._userLogHandler=null,vh.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in D))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Eh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...t),this._logHandler(this,D.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...t),this._logHandler(this,D.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,D.INFO,...t),this._logHandler(this,D.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,D.WARN,...t),this._logHandler(this,D.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,D.ERROR,...t),this._logHandler(this,D.ERROR,...t)}};var Sh=(e,t)=>t.some(n=>e instanceof n),qa,Ua;function bh(){return qa||(qa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Rh(){return Ua||(Ua=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var za=new WeakMap,Ii=new WeakMap,ja=new WeakMap,Ei=new WeakMap,Ai=new WeakMap;function Ph(e){let t=new Promise((n,r)=>{let i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{n(gt(e.result)),i()},o=()=>{r(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",o)});return t.then(n=>{n instanceof IDBCursor&&za.set(n,e)}).catch(()=>{}),Ai.set(t,e),t}function Ch(e){if(Ii.has(e))return;let t=new Promise((n,r)=>{let i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)});Ii.set(e,t)}var Ti={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Ii.get(e);if(t==="objectStoreNames")return e.objectStoreNames||ja.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return gt(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ga(e){Ti=e(Ti)}function Dh(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){let r=e.call(Wn(this),t,...n);return ja.set(r,t.sort?t.sort():[t]),gt(r)}:Rh().includes(e)?function(...t){return e.apply(Wn(this),t),gt(za.get(this))}:function(...t){return gt(e.apply(Wn(this),t))}}function xh(e){return typeof e=="function"?Dh(e):(e instanceof IDBTransaction&&Ch(e),Sh(e,bh())?new Proxy(e,Ti):e)}function gt(e){if(e instanceof IDBRequest)return Ph(e);if(Ei.has(e))return Ei.get(e);let t=xh(e);return t!==e&&(Ei.set(e,t),Ai.set(t,e)),t}var Wn=e=>Ai.get(e);function Ka(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,t),a=gt(o);return r&&o.addEventListener("upgradeneeded",c=>{r(gt(o.result),c.oldVersion,c.newVersion,gt(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Vh=["get","getKey","getAll","getAllKeys","count"],Nh=["put","add","delete","clear"],Si=new Map;function $a(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Si.get(t))return Si.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=Nh.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Vh.includes(n)))return;let s=function(o,...a){return p(this,null,function*(){let c=this.transaction(o,i?"readwrite":"readonly"),u=c.store;return r&&(u=u.index(a.shift())),(yield Promise.all([u[n](...a),i&&c.done]))[0]})};return Si.set(t,s),s}Ga(e=>Da(jn({},e),{get:(t,n,r)=>$a(t,n)||e.get(t,n,r),has:(t,n)=>!!$a(t,n)||e.has(t,n)}));var Ri=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(kh(n)){let r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}};function kh(e){let t=e.getComponent();return t?.type==="VERSION"}var Pi="@firebase/app",Qa="0.9.27";var Qt=new me("@firebase/app"),Oh="@firebase/app-compat",Mh="@firebase/analytics-compat",Lh="@firebase/analytics",Fh="@firebase/app-check-compat",Bh="@firebase/app-check",qh="@firebase/auth",Uh="@firebase/auth-compat",zh="@firebase/database",jh="@firebase/database-compat",Gh="@firebase/functions",$h="@firebase/functions-compat",Kh="@firebase/installations",Qh="@firebase/installations-compat",Wh="@firebase/messaging",Hh="@firebase/messaging-compat",Yh="@firebase/performance",Xh="@firebase/performance-compat",Jh="@firebase/remote-config",Zh="@firebase/remote-config-compat",td="@firebase/storage",ed="@firebase/storage-compat",nd="@firebase/firestore",rd="@firebase/firestore-compat",id="firebase",sd="10.8.0";var Ci="[DEFAULT]",od={[Pi]:"fire-core",[Oh]:"fire-core-compat",[Lh]:"fire-analytics",[Mh]:"fire-analytics-compat",[Bh]:"fire-app-check",[Fh]:"fire-app-check-compat",[qh]:"fire-auth",[Uh]:"fire-auth-compat",[zh]:"fire-rtdb",[jh]:"fire-rtdb-compat",[Gh]:"fire-fn",[$h]:"fire-fn-compat",[Kh]:"fire-iid",[Qh]:"fire-iid-compat",[Wh]:"fire-fcm",[Hh]:"fire-fcm-compat",[Yh]:"fire-perf",[Xh]:"fire-perf-compat",[Jh]:"fire-rc",[Zh]:"fire-rc-compat",[td]:"fire-gcs",[ed]:"fire-gcs-compat",[nd]:"fire-fst",[rd]:"fire-fst-compat","fire-js":"fire-js",[id]:"fire-js-all"};var Hn=new Map,Di=new Map;function ad(e,t){try{e.container.addComponent(t)}catch(n){Qt.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function We(e){let t=e.name;if(Di.has(t))return Qt.debug(`There were multiple attempts to register component ${t}.`),!1;Di.set(t,e);for(let n of Hn.values())ad(n,e);return!0}function Xa(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}var cd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Ot=new $e("app","Firebase",cd);var xi=class{constructor(t,n,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ct("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ot.create("app-deleted",{appName:this._name})}};var Ja=sd;function ki(e,t={}){let n=e;typeof t!="object"&&(t={name:t});let r=Object.assign({name:Ci,automaticDataCollectionEnabled:!1},t),i=r.name;if(typeof i!="string"||!i)throw Ot.create("bad-app-name",{appName:String(i)});if(n||(n=wi()),!n)throw Ot.create("no-options");let s=Hn.get(i);if(s){if(Qe(n,s.options)&&Qe(r,s.config))return s;throw Ot.create("duplicate-app",{appName:i})}let o=new Qn(i);for(let c of Di.values())o.addComponent(c);let a=new xi(n,r,o);return Hn.set(i,a),a}function Za(e=Ci){let t=Hn.get(e);if(!t&&e===Ci&&wi())return ki();if(!t)throw Ot.create("no-app",{appName:e});return t}function Mt(e,t,n){var r;let i=(r=od[e])!==null&&r!==void 0?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${t}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Qt.warn(a.join(" "));return}We(new Ct(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}var ud="firebase-heartbeat-database",ld=1,He="firebase-heartbeat-store",bi=null;function tc(){return bi||(bi=Ka(ud,ld,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(He)}catch(n){console.warn(n)}}}}).catch(e=>{throw Ot.create("idb-open",{originalErrorMessage:e.message})})),bi}function hd(e){return p(this,null,function*(){try{let n=(yield tc()).transaction(He),r=yield n.objectStore(He).get(ec(e));return yield n.done,r}catch(t){if(t instanceof Rt)Qt.warn(t.message);else{let n=Ot.create("idb-get",{originalErrorMessage:t?.message});Qt.warn(n.message)}}})}function Wa(e,t){return p(this,null,function*(){try{let r=(yield tc()).transaction(He,"readwrite");yield r.objectStore(He).put(t,ec(e)),yield r.done}catch(n){if(n instanceof Rt)Qt.warn(n.message);else{let r=Ot.create("idb-set",{originalErrorMessage:n?.message});Qt.warn(r.message)}}})}function ec(e){return`${e.name}!${e.options.appId}`}var dd=1024,fd=30*24*60*60*1e3,Vi=class{constructor(t){this.container=t,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new Ni(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return p(this,null,function*(){var t,n;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ha();if(!(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=fd}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return p(this,null,function*(){var t;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let n=Ha(),{heartbeatsToSend:r,unsentEntries:i}=md(this._heartbeatsCache.heartbeats),s=Ge(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s})}};function Ha(){return new Date().toISOString().substring(0,10)}function md(e,t=dd){let n=[],r=e.slice();for(let i of e){let s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Ya(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ya(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var Ni=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return p(this,null,function*(){return Kn()?Ba().then(()=>!0).catch(()=>!1):!1})}read(){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield hd(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return p(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Wa(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return p(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Wa(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return})}};function Ya(e){return Ge(JSON.stringify({version:2,heartbeats:e})).length}function gd(e){We(new Ct("platform-logger",t=>new Ri(t),"PRIVATE")),We(new Ct("heartbeat",t=>new Vi(t),"PRIVATE")),Mt(Pi,Qa,e),Mt(Pi,Qa,"esm2017"),Mt("fire-js","")}gd("");var pd="firebase",_d="10.8.0";Mt(pd,_d,"app");var yd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ft={},_,ns=ns||{},T=yd||self;function ur(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function ln(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function wd(e){return Object.prototype.hasOwnProperty.call(e,Oi)&&e[Oi]||(e[Oi]=++vd)}var Oi="closure_uid_"+(1e9*Math.random()>>>0),vd=0;function Ed(e,t,n){return e.call.apply(e.bind,arguments)}function Id(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function X(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?X=Ed:X=Id,X.apply(null,arguments)}function Yn(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function $(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function Lt(){this.s=this.s,this.o=this.o}var Td=0;Lt.prototype.s=!1;Lt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Td!=0)&&wd(this)};Lt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var mc=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function rs(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function nc(e,t){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(ur(r)){let i=e.length||0,s=r.length||0;e.length=i+s;for(let o=0;o<s;o++)e[i+o]=r[o]}else e.push(r)}}function J(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};var Ad=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let n=()=>{};T.addEventListener("test",n,t),T.removeEventListener("test",n,t)}catch{}return e}();function en(e){return/^[\s\xa0]*$/.test(e)}function lr(){var e=T.navigator;return e&&(e=e.userAgent)?e:""}function pt(e){return lr().indexOf(e)!=-1}function is(e){return is[" "](e),e}is[" "]=function(){};function Sd(e,t){var n=mf;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}var bd=pt("Opera"),ye=pt("Trident")||pt("MSIE"),gc=pt("Edge"),qi=gc||ye,pc=pt("Gecko")&&!(lr().toLowerCase().indexOf("webkit")!=-1&&!pt("Edge"))&&!(pt("Trident")||pt("MSIE"))&&!pt("Edge"),Rd=lr().toLowerCase().indexOf("webkit")!=-1&&!pt("Edge");function _c(){var e=T.document;return e?e.documentMode:void 0}var Ui;t:{if(Xn="",Jn=function(){var e=lr();if(pc)return/rv:([^\);]+)(\)|;)/.exec(e);if(gc)return/Edge\/([\d\.]+)/.exec(e);if(ye)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(Rd)return/WebKit\/(\S+)/.exec(e);if(bd)return/(?:Version)[ \/]?(\S+)/.exec(e)}(),Jn&&(Xn=Jn?Jn[1]:""),ye&&(Zn=_c(),Zn!=null&&Zn>parseFloat(Xn))){Ui=String(Zn);break t}Ui=Xn}var Xn,Jn,Zn,zi;T.document&&ye?(Mi=_c(),zi=Mi||parseInt(Ui,10)||void 0):zi=void 0;var Mi,Pd=zi;function nn(e,t){if(J.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(pc){t:{try{is(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:Cd[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&nn.$.h.call(this)}}$(nn,J);var Cd={2:"touch",3:"pen",4:"mouse"};nn.prototype.h=function(){nn.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var hn="closure_listenable_"+(1e6*Math.random()|0),Dd=0;function xd(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Dd,this.fa=this.ia=!1}function hr(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function ss(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function Vd(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function yc(e){let t={};for(let n in e)t[n]=e[n];return t}var rc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function wc(e,t){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(let s=0;s<rc.length;s++)n=rc[s],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function dr(e){this.src=e,this.g={},this.h=0}dr.prototype.add=function(e,t,n,r,i){var s=e.toString();e=this.g[s],e||(e=this.g[s]=[],this.h++);var o=Gi(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):(t=new xd(t,this.src,s,!!r,i),t.ia=n,e.push(t)),t};function ji(e,t){var n=t.type;if(n in e.g){var r=e.g[n],i=mc(r,t),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(hr(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function Gi(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}var os="closure_lm_"+(1e6*Math.random()|0),Li={};function vc(e,t,n,r,i){if(r&&r.once)return Ic(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)vc(e,t[s],n,r,i);return null}return n=us(n),e&&e[hn]?e.O(t,n,ln(r)?!!r.capture:!!r,i):Ec(e,t,n,!1,r,i)}function Ec(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=ln(i)?!!i.capture:!!i,a=cs(e);if(a||(e[os]=a=new dr(e)),n=a.add(t,n,r,o,s),n.proxy)return n;if(r=Nd(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Ad||(i=o),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Ac(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Nd(){function e(n){return t.call(e.src,e.listener,n)}let t=kd;return e}function Ic(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ic(e,t[s],n,r,i);return null}return n=us(n),e&&e[hn]?e.P(t,n,ln(r)?!!r.capture:!!r,i):Ec(e,t,n,!0,r,i)}function Tc(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Tc(e,t[s],n,r,i);else r=ln(r)?!!r.capture:!!r,n=us(n),e&&e[hn]?(e=e.i,t=String(t).toString(),t in e.g&&(s=e.g[t],n=Gi(s,n,r,i),-1<n&&(hr(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete e.g[t],e.h--)))):e&&(e=cs(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Gi(t,n,r,i)),(n=-1<e?t[e]:null)&&as(n))}function as(e){if(typeof e!="number"&&e&&!e.fa){var t=e.src;if(t&&t[hn])ji(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ac(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=cs(t))?(ji(n,e),n.h==0&&(n.src=null,t[os]=null)):hr(e)}}}function Ac(e){return e in Li?Li[e]:Li[e]="on"+e}function kd(e,t){if(e.fa)e=!0;else{t=new nn(t,this);var n=e.listener,r=e.la||e.src;e.ia&&as(e),e=n.call(r,t)}return e}function cs(e){return e=e[os],e instanceof dr?e:null}var Fi="__closure_events_fn_"+(1e9*Math.random()>>>0);function us(e){return typeof e=="function"?e:(e[Fi]||(e[Fi]=function(t){return e.handleEvent(t)}),e[Fi])}function G(){Lt.call(this),this.i=new dr(this),this.S=this,this.J=null}$(G,Lt);G.prototype[hn]=!0;G.prototype.removeEventListener=function(e,t,n,r){Tc(this,e,t,n,r)};function H(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,typeof t=="string")t=new J(t,e);else if(t instanceof J)t.target=t.target||e;else{var i=t;t=new J(r,e),wc(t,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=tr(o,r,!0,t)&&i}if(o=t.g=e,i=tr(o,r,!0,t)&&i,i=tr(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)o=t.g=n[s],i=tr(o,r,!1,t)&&i}G.prototype.N=function(){if(G.$.N.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)hr(n[r]);delete e.g[t],e.h--}}this.J=null};G.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};G.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function tr(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&ji(e.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var ls=T.JSON.stringify,$i=class{constructor(t,n){this.i=t,this.j=n,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function Od(){var e=hs;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Ki=class{constructor(){this.h=this.g=null}add(t,n){let r=Sc.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r}},Sc=new $i(()=>new Qi,e=>e.reset()),Qi=class{constructor(){this.next=this.g=this.h=null}set(t,n){this.h=t,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function Md(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ld(e){T.setTimeout(()=>{throw e},0)}var rn,sn=!1,hs=new Ki,bc=()=>{let e=T.Promise.resolve(void 0);rn=()=>{e.then(Fd)}},Fd=()=>{for(var e;e=Od();){try{e.h.call(e.g)}catch(n){Ld(n)}var t=Sc;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}sn=!1};function fr(e,t){G.call(this),this.h=e||1,this.g=t||T,this.j=X(this.qb,this),this.l=Date.now()}$(fr,G);_=fr.prototype;_.ga=!1;_.T=null;_.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),H(this,"tick"),this.ga&&(ds(this),this.start()))}};_.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ds(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}_.N=function(){fr.$.N.call(this),ds(this),delete this.g};function fs(e,t,n){if(typeof e=="function")n&&(e=X(e,n));else if(e&&typeof e.handleEvent=="function")e=X(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:T.setTimeout(e,t||0)}function Rc(e){e.g=fs(()=>{e.g=null,e.i&&(e.i=!1,Rc(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}var Wi=class extends Lt{constructor(t,n){super(),this.m=t,this.j=n,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Rc(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function on(e){Lt.call(this),this.h=e,this.g={}}$(on,Lt);var ic=[];function Pc(e,t,n,r){Array.isArray(n)||(n&&(ic[0]=n.toString()),n=ic);for(var i=0;i<n.length;i++){var s=vc(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Cc(e){ss(e.g,function(t,n){this.g.hasOwnProperty(n)&&as(t)},e),e.g={}}on.prototype.N=function(){on.$.N.call(this),Cc(this)};on.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function mr(){this.g=!0}mr.prototype.Ea=function(){this.g=!1};function Bd(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+o})}function qd(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+s+" "+o})}function pe(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+zd(e,n)+(r?" "+r:"")})}function Ud(e,t){e.info(function(){return"TIMEOUT: "+t})}mr.prototype.info=function(){};function zd(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return ls(n)}catch{return t}}var Xt={},sc=null;function gr(){return sc=sc||new G}Xt.Ta="serverreachability";function Dc(e){J.call(this,Xt.Ta,e)}$(Dc,J);function an(e){let t=gr();H(t,new Dc(t))}Xt.STAT_EVENT="statevent";function xc(e,t){J.call(this,Xt.STAT_EVENT,e),this.stat=t}$(xc,J);function et(e){let t=gr();H(t,new xc(t,e))}Xt.Ua="timingevent";function Vc(e,t){J.call(this,Xt.Ua,e),this.size=t}$(Vc,J);function dn(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){e()},t)}var pr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Nc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ms(){}ms.prototype.h=null;function oc(e){return e.h||(e.h=e.i())}function kc(){}var fn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function gs(){J.call(this,"d")}$(gs,J);function ps(){J.call(this,"c")}$(ps,J);var Hi;function _r(){}$(_r,ms);_r.prototype.g=function(){return new XMLHttpRequest};_r.prototype.i=function(){return{}};Hi=new _r;function mn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new on(this),this.P=jd,e=qi?125:void 0,this.V=new fr(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Oc}function Oc(){this.i=null,this.g="",this.h=!1}var jd=45e3,Mc={},Yi={};_=mn.prototype;_.setTimeout=function(e){this.P=e};function Xi(e,t,n){e.L=1,e.A=wr(xt(t)),e.u=n,e.S=!0,Lc(e,null)}function Lc(e,t){e.G=Date.now(),gn(e),e.B=xt(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),$c(n.i,"t",r),e.o=0,n=e.l.J,e.h=new Oc,e.g=du(e.l,n?t:null,!e.u),0<e.O&&(e.M=new Wi(X(e.Pa,e,e.g),e.O)),Pc(e.U,e.g,"readystatechange",e.nb),t=e.I?yc(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),an(),Bd(e.j,e.v,e.B,e.m,e.W,e.u)}_.nb=function(e){e=e.target;let t=this.M;t&&_t(e)==3?t.l():this.Pa(e)};_.Pa=function(e){try{if(e==this.g)t:{let l=_t(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||qi||this.g&&(this.h.h||this.g.ja()||lc(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?an(3):an(2)),yr(this);var n=this.g.da();this.ca=n;e:if(Fc(this)){var r=lc(this.g);e="";var i=r.length,s=_t(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wt(this),tn(this);var o="";break e}this.h.i=new T.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,qd(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!en(a)){var u=a;break e}}u=null}if(n=u)pe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ji(this,n);else{this.i=!1,this.s=3,et(12),Wt(this),tn(this);break t}}this.S?(Bc(this,l,o),qi&&this.i&&l==3&&(Pc(this.U,this.V,"tick",this.mb),this.V.start())):(pe(this.j,this.m,o,null),Ji(this,o)),l==4&&Wt(this),this.i&&!this.J&&(l==4?cu(this.l,this):(this.i=!1,gn(this)))}else hf(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,et(12)):(this.s=0,et(13)),Wt(this),tn(this)}}}catch{}finally{}};function Fc(e){return e.g?e.v=="GET"&&e.L!=2&&e.l.Ha:!1}function Bc(e,t,n){let r=!0,i;for(;!e.J&&e.o<n.length;)if(i=Gd(e,n),i==Yi){t==4&&(e.s=4,et(14),r=!1),pe(e.j,e.m,null,"[Incomplete Response]");break}else if(i==Mc){e.s=4,et(15),pe(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else pe(e.j,e.m,i,null),Ji(e,i);Fc(e)&&e.o!=0&&(e.h.g=e.h.g.slice(e.o),e.o=0),t!=4||n.length!=0||e.h.h||(e.s=1,et(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,t=e.l,t.g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Is(t),t.M=!0,et(11))):(pe(e.j,e.m,n,"[Invalid Chunked Response]"),Wt(e),tn(e))}_.mb=function(){if(this.g){var e=_t(this.g),t=this.g.ja();this.o<t.length&&(yr(this),Bc(this,e,t),this.i&&e!=4&&gn(this))}};function Gd(e,t){var n=e.o,r=t.indexOf(`
`,n);return r==-1?Yi:(n=Number(t.substring(n,r)),isNaN(n)?Mc:(r+=1,r+n>t.length?Yi:(t=t.slice(r,r+n),e.o=r+n,t)))}_.cancel=function(){this.J=!0,Wt(this)};function gn(e){e.Y=Date.now()+e.P,qc(e,e.P)}function qc(e,t){if(e.C!=null)throw Error("WatchDog timer not null");e.C=dn(X(e.lb,e),t)}function yr(e){e.C&&(T.clearTimeout(e.C),e.C=null)}_.lb=function(){this.C=null;let e=Date.now();0<=e-this.Y?(Ud(this.j,this.B),this.L!=2&&(an(),et(17)),Wt(this),this.s=2,tn(this)):qc(this,this.Y-e)};function tn(e){e.l.H==0||e.J||cu(e.l,e)}function Wt(e){yr(e);var t=e.M;t&&typeof t.sa=="function"&&t.sa(),e.M=null,ds(e.V),Cc(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Ji(e,t){try{var n=e.l;if(n.H!=0&&(n.g==e||Zi(n.i,e))){if(!e.K&&Zi(n.i,e)&&n.H==3){try{var r=n.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!n.u){if(n.g)if(n.g.G+3e3<e.G)sr(n),Ir(n);else break t;Es(n),et(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=dn(X(n.ib,n),6e3));if(1>=Wc(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Ht(n,11)}else if((e.K||n.g==e)&&sr(n),!en(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],n.H==2)if(u[0]=="c"){n.K=u[1],n.pa=u[2];let l=u[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let h=u[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));let d=u[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let m=e.g;if(m){let A=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(A){var s=r.i;s.g||A.indexOf("spdy")==-1&&A.indexOf("quic")==-1&&A.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(_s(s,s.h),s.h=null))}if(r.F){let S=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,O(r.I,r.F,S))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=e;if(r.wa=hu(r,r.J?r.pa:null,r.Y),o.K){Hc(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(yr(a),gn(a)),r.g=o}else ou(r);0<n.j.length&&Tr(n)}else u[0]!="stop"&&u[0]!="close"||Ht(n,7);else n.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?Ht(n,7):vs(n):u[0]!="noop"&&n.h&&n.h.Aa(u),n.A=0)}}an(4)}catch{}}function $d(e){if(e.Z&&typeof e.Z=="function")return e.Z();if(typeof Map<"u"&&e instanceof Map||typeof Set<"u"&&e instanceof Set)return Array.from(e.values());if(typeof e=="string")return e.split("");if(ur(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function Kd(e){if(e.ta&&typeof e.ta=="function")return e.ta();if(!e.Z||typeof e.Z!="function"){if(typeof Map<"u"&&e instanceof Map)return Array.from(e.keys());if(!(typeof Set<"u"&&e instanceof Set)){if(ur(e)||typeof e=="string"){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(let r in e)t[n++]=r;return t}}}function Uc(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(ur(e)||typeof e=="string")Array.prototype.forEach.call(e,t,void 0);else for(var n=Kd(e),r=$d(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}var zc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qd(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Yt(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Yt){this.h=e.h,rr(this,e.j),this.s=e.s,this.g=e.g,ir(this,e.m),this.l=e.l;var t=e.i,n=new cn;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ac(this,n),this.o=e.o}else e&&(t=String(e).match(zc))?(this.h=!1,rr(this,t[1]||"",!0),this.s=Je(t[2]||""),this.g=Je(t[3]||"",!0),ir(this,t[4]),this.l=Je(t[5]||"",!0),ac(this,t[6]||"",!0),this.o=Je(t[7]||"")):(this.h=!1,this.i=new cn(null,this.h))}Yt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ze(t,cc,!0),":");var n=this.g;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(Ze(t,cc,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&e.push("/"),e.push(Ze(n,n.charAt(0)=="/"?Yd:Hd,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ze(n,Jd)),e.join("")};function xt(e){return new Yt(e)}function rr(e,t,n){e.j=n?Je(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ir(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function ac(e,t,n){t instanceof cn?(e.i=t,Zd(e.i,e.h)):(n||(t=Ze(t,Xd)),e.i=new cn(t,e.h))}function O(e,t,n){e.i.set(t,n)}function wr(e){return O(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Je(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ze(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,Wd),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Wd(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var cc=/[#\/\?@]/g,Hd=/[#\?:]/g,Yd=/[#\?]/g,Xd=/[#\?@]/g,Jd=/#/g;function cn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ft(e){e.g||(e.g=new Map,e.h=0,e.i&&Qd(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}_=cn.prototype;_.add=function(e,t){Ft(this),this.i=null,e=we(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function jc(e,t){Ft(e),t=we(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Gc(e,t){return Ft(e),t=we(e,t),e.g.has(t)}_.forEach=function(e,t){Ft(this),this.g.forEach(function(n,r){n.forEach(function(i){e.call(t,i,r,this)},this)},this)};_.ta=function(){Ft(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let s=0;s<i.length;s++)n.push(t[r])}return n};_.Z=function(e){Ft(this);let t=[];if(typeof e=="string")Gc(this,e)&&(t=t.concat(this.g.get(we(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t};_.set=function(e,t){return Ft(this),this.i=null,e=we(this,e),Gc(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};_.get=function(e,t){return e?(e=this.Z(e),0<e.length?String(e[0]):t):t};function $c(e,t,n){jc(e,t),0<n.length&&(e.i=null,e.g.set(we(e,t),rs(n)),e.h+=n.length)}_.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};function we(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Zd(e,t){t&&!e.j&&(Ft(e),e.i=null,e.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(jc(this,r),$c(this,i,n))},e)),e.j=t}var tf=class{constructor(e,t){this.g=e,this.map=t}};function Kc(e){this.l=e||ef,T.PerformanceNavigationTiming?(e=T.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(T.g&&T.g.Ka&&T.g.Ka()&&T.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ef=10;function Qc(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function Wc(e){return e.h?1:e.g?e.g.size:0}function Zi(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function _s(e,t){e.g?e.g.add(t):e.h=t}function Hc(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}Kc.prototype.cancel=function(){if(this.i=Yc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let e of this.g.values())e.cancel();this.g.clear()}};function Yc(e){if(e.h!=null)return e.i.concat(e.h.F);if(e.g!=null&&e.g.size!==0){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return rs(e.i)}var nf=class{stringify(e){return T.JSON.stringify(e,void 0)}parse(e){return T.JSON.parse(e,void 0)}};function rf(){this.g=new nf}function sf(e,t,n){let r=n||"";try{Uc(e,function(i,s){let o=i;ln(i)&&(o=ls(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function of(e,t){let n=new mr;if(T.Image){let r=new Image;r.onload=Yn(er,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Yn(er,n,r,"TestLoadImage: error",!1,t),r.onabort=Yn(er,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Yn(er,n,r,"TestLoadImage: timeout",!1,t),T.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function er(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function pn(e){this.l=e.ec||null,this.j=e.ob||!1}$(pn,ms);pn.prototype.g=function(){return new vr(this.l,this.j)};pn.prototype.i=function(e){return function(){return e}}({});function vr(e,t){G.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=ys,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}$(vr,G);var ys=0;_=vr.prototype;_.open=function(e,t){if(this.readyState!=ys)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,un(this)};_.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||T).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,_n(this)),this.readyState=ys};_.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,un(this)),this.g&&(this.readyState=3,un(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xc(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))};function Xc(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}_.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?_n(this):un(this),this.readyState==3&&Xc(this)}};_.Za=function(e){this.g&&(this.response=this.responseText=e,_n(this))};_.Ya=function(e){this.g&&(this.response=e,_n(this))};_.ka=function(){this.g&&_n(this)};function _n(e){e.readyState=4,e.l=null,e.j=null,e.A=null,un(e)}_.setRequestHeader=function(e,t){this.v.append(e,t)};_.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};_.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function un(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(vr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var af=T.JSON.parse;function M(e){G.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Jc,this.L=this.M=!1}$(M,G);var Jc="",cf=/^https?$/i,uf=["POST","PUT"];_=M.prototype;_.Oa=function(e){this.M=e};_.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Hi.g(),this.C=this.u?oc(this.u):oc(Hi),this.g.onreadystatechange=X(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(s){uc(this,s);return}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=T.FormData&&e instanceof T.FormData,!(0<=mc(uf,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{eu(this),0<this.B&&((this.L=lf(this.g))?(this.g.timeout=this.B,this.g.ontimeout=X(this.ua,this)):this.A=fs(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){uc(this,s)}};function lf(e){return ye&&typeof e.timeout=="number"&&e.ontimeout!==void 0}_.ua=function(){typeof ns<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,H(this,"timeout"),this.abort(8))};function uc(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Zc(e),Er(e)}function Zc(e){e.F||(e.F=!0,H(e,"complete"),H(e,"error"))}_.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,H(this,"complete"),H(this,"abort"),Er(this))};_.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Er(this,!0)),M.$.N.call(this)};_.La=function(){this.s||(this.G||this.v||this.l?tu(this):this.kb())};_.kb=function(){tu(this)};function tu(e){if(e.h&&typeof ns<"u"&&(!e.C[1]||_t(e)!=4||e.da()!=2)){if(e.v&&_t(e)==4)fs(e.La,0,e);else if(H(e,"readystatechange"),_t(e)==4){e.h=!1;try{let o=e.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var n;if(!(n=t)){var r;if(r=o===0){var i=String(e.I).match(zc)[1]||null;!i&&T.self&&T.self.location&&(i=T.self.location.protocol.slice(0,-1)),r=!cf.test(i?i.toLowerCase():"")}n=r}if(n)H(e,"complete"),H(e,"success");else{e.m=6;try{var s=2<_t(e)?e.g.statusText:""}catch{s=""}e.j=s+" ["+e.da()+"]",Zc(e)}}finally{Er(e)}}}}function Er(e,t){if(e.g){eu(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||H(e,"ready");try{n.onreadystatechange=r}catch{}}}function eu(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(T.clearTimeout(e.A),e.A=null)}_.isActive=function(){return!!this.g};function _t(e){return e.g?e.g.readyState:0}_.da=function(){try{return 2<_t(this)?this.g.status:-1}catch{return-1}};_.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};_.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),af(t)}};function lc(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Jc:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function hf(e){let t={};e=(e.g&&2<=_t(e)&&e.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<e.length;r++){if(en(e[r]))continue;var n=Md(e[r]);let i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}Vd(t,function(r){return r.join(", ")})}_.Ia=function(){return this.m};_.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function nu(e){let t="";return ss(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function ws(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=nu(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):O(e,t,n))}function Ye(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function ru(e){this.Ga=0,this.j=[],this.l=new mr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ye("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ye("baseRetryDelayMs",5e3,e),this.hb=Ye("retryDelaySeedMs",1e4,e),this.eb=Ye("forwardChannelMaxRetries",2,e),this.xa=Ye("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Kc(e&&e.concurrentRequestLimit),this.Ja=new rf,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}_=ru.prototype;_.ra=8;_.H=1;function vs(e){if(iu(e),e.H==3){var t=e.W++,n=xt(e.I);if(O(n,"SID",e.K),O(n,"RID",t),O(n,"TYPE","terminate"),yn(e,n),t=new mn(e,e.l,t),t.L=2,t.A=wr(xt(n)),n=!1,T.navigator&&T.navigator.sendBeacon)try{n=T.navigator.sendBeacon(t.A.toString(),"")}catch{}!n&&T.Image&&(new Image().src=t.A,n=!0),n||(t.g=du(t.l,null),t.g.ha(t.A)),t.G=Date.now(),gn(t)}lu(e)}function Ir(e){e.g&&(Is(e),e.g.cancel(),e.g=null)}function iu(e){Ir(e),e.u&&(T.clearTimeout(e.u),e.u=null),sr(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&T.clearTimeout(e.m),e.m=null)}function Tr(e){if(!Qc(e.i)&&!e.m){e.m=!0;var t=e.Na;rn||bc(),sn||(rn(),sn=!0),hs.add(t,e),e.C=0}}function df(e,t){return Wc(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.j=t.F.concat(e.j),!0):e.H==1||e.H==2||e.C>=(e.cb?0:e.eb)?!1:(e.m=dn(X(e.Na,e,t),uu(e,e.C)),e.C++,!0)}_.Na=function(e){if(this.m)if(this.m=null,this.H==1){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new mn(this,this.l,e),s=this.s;if(this.U&&(s?(s=yc(s),wc(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,n=0;n<this.j.length;n++){e:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=n;break t}if(t===4096||n===this.j.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=su(this,i,t),n=xt(this.I),O(n,"RID",e),O(n,"CVER",22),this.F&&O(n,"X-HTTP-Session-Id",this.F),yn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(nu(s)))+"&"+t:this.o&&ws(n,this.o,s)),_s(this.i,i),this.bb&&O(n,"TYPE","init"),this.P?(O(n,"$req",t),O(n,"SID","null"),i.aa=!0,Xi(i,n,null)):Xi(i,n,t),this.H=2}}else this.H==3&&(e?hc(this,e):this.j.length==0||Qc(this.i)||hc(this))};function hc(e,t){var n;t?n=t.m:n=e.W++;let r=xt(e.I);O(r,"SID",e.K),O(r,"RID",n),O(r,"AID",e.V),yn(e,r),e.o&&e.s&&ws(r,e.o,e.s),n=new mn(e,e.l,n,e.C+1),e.o===null&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=su(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),_s(e.i,n),Xi(n,r,t)}function yn(e,t){e.na&&ss(e.na,function(n,r){O(t,r,n)}),e.h&&Uc({},function(n,r){O(t,r,n)})}function su(e,t,n){n=Math.min(e.j.length,n);var r=e.h?X(e.h.Va,e.h,e):null;t:{var i=e.j;let s=-1;for(;;){let o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<n;c++){let u=i[c].g,l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{sf(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return e=e.j.splice(0,n),t.F=e,r}function ou(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;rn||bc(),sn||(rn(),sn=!0),hs.add(t,e),e.A=0}}function Es(e){return e.g||e.u||3<=e.A?!1:(e.ba++,e.u=dn(X(e.Ma,e),uu(e,e.A)),e.A++,!0)}_.Ma=function(){if(this.u=null,au(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=dn(X(this.jb,this),e)}};_.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,et(10),Ir(this),au(this))};function Is(e){e.B!=null&&(T.clearTimeout(e.B),e.B=null)}function au(e){e.g=new mn(e,e.l,"rpc",e.ba),e.o===null&&(e.g.I=e.s),e.g.O=0;var t=xt(e.wa);O(t,"RID","rpc"),O(t,"SID",e.K),O(t,"AID",e.V),O(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&O(t,"TO",e.qa),O(t,"TYPE","xmlhttp"),yn(e,t),e.o&&e.s&&ws(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=wr(xt(t)),n.u=null,n.S=!0,Lc(n,e)}_.ib=function(){this.v!=null&&(this.v=null,Ir(this),Es(this),et(19))};function sr(e){e.v!=null&&(T.clearTimeout(e.v),e.v=null)}function cu(e,t){var n=null;if(e.g==t){sr(e),Is(e),e.g=null;var r=2}else if(Zi(e.i,t))n=t.F,Hc(e.i,t),r=1;else return;if(e.H!=0){if(t.i)if(r==1){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;r=gr(),H(r,new Vc(r,n)),Tr(e)}else ou(e);else if(i=t.s,i==3||i==0&&0<t.ca||!(r==1&&df(e,t)||r==2&&Es(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Ht(e,5);break;case 4:Ht(e,10);break;case 3:Ht(e,6);break;default:Ht(e,2)}}}function uu(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Ht(e,t){if(e.l.info("Error code "+t),t==2){var n=null;e.h&&(n=null);var r=X(e.pb,e);n||(n=new Yt("//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||rr(n,"https"),wr(n)),of(n.toString(),r)}else et(2);e.H=0,e.h&&e.h.za(t),lu(e),iu(e)}_.pb=function(e){e?(this.l.info("Successfully pinged google.com"),et(2)):(this.l.info("Failed to ping google.com"),et(1))};function lu(e){if(e.H=0,e.ma=[],e.h){let t=Yc(e.i);(t.length!=0||e.j.length!=0)&&(nc(e.ma,t),nc(e.ma,e.j),e.i.i.length=0,rs(e.j),e.j.length=0),e.h.ya()}}function hu(e,t,n){var r=n instanceof Yt?xt(n):new Yt(n);if(r.g!="")t&&(r.g=t+"."+r.g),ir(r,r.m);else{var i=T.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Yt(null);r&&rr(s,r),t&&(s.g=t),i&&ir(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&O(r,n,t),O(r,"VER",e.ra),yn(e,r),r}function du(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=e.Ha&&!e.va?new M(new pn({ob:n})):new M(e.va),t.Oa(e.J),t}_.isActive=function(){return!!this.h&&this.h.isActive(this)};function fu(){}_=fu.prototype;_.Ba=function(){};_.Aa=function(){};_.za=function(){};_.ya=function(){};_.isActive=function(){return!0};_.Va=function(){};function or(){if(ye&&!(10<=Number(Pd)))throw Error("Environmental error: no available transport.")}or.prototype.g=function(e,t){return new st(e,t)};function st(e,t){G.call(this),this.g=new ru(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!en(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!en(t)&&(this.g.F=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new ve(this)}$(st,G);st.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;et(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=hu(e,null,e.Y),Tr(e)};st.prototype.close=function(){vs(this.g)};st.prototype.u=function(e){var t=this.g;if(typeof e=="string"){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=ls(e),e=n);t.j.push(new tf(t.fb++,e)),t.H==3&&Tr(t)};st.prototype.N=function(){this.g.h=null,delete this.j,vs(this.g),delete this.g,st.$.N.call(this)};function mu(e){gs.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){t:{for(let n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}$(mu,gs);function gu(){ps.call(this),this.status=1}$(gu,ps);function ve(e){this.g=e}$(ve,fu);ve.prototype.Ba=function(){H(this.g,"a")};ve.prototype.Aa=function(e){H(this.g,new mu(e))};ve.prototype.za=function(e){H(this.g,new gu)};ve.prototype.ya=function(){H(this.g,"b")};function ff(){this.blockSize=-1}function dt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}$(dt,ff);dt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Bi(e,t,n){n||(n=0);var r=Array(16);if(typeof t=="string")for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(s^n&(i^s))+r[4]+4118548399&4294967295,t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(s^n&(i^s))+r[8]+1770035416&4294967295,t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(s^n&(i^s))+r[12]+1804603682&4294967295,t=n+(o<<7&4294967295|o>>>25),o=s+(i^t&(n^i))+r[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(n^s&(t^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(t^i&(s^t))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(n^i))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(n^i))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(t^n))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^t&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(n^i^s)+r[5]+4294588738&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^s)+r[1]+2763975236&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^s)+r[13]+681279174&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^s)+r[9]+3654602809&4294967295,t=n+(o<<4&4294967295|o>>>28),o=s+(t^n^i)+r[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^t)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(i^(n|~s))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~s))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=s+(n^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}dt.prototype.j=function(e,t){t===void 0&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(i==0)for(;s<=n;)Bi(this,e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Bi(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Bi(this,r),i=0;break}}this.h=i,this.i+=t};dt.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=n&255,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};function V(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=e[i]|0;r&&s==t||(n[i]=s,r=!1)}this.g=n}var mf={};function Ts(e){return-128<=e&&128>e?Sd(e,function(t){return new V([t|0],0>t?-1:0)}):new V([e|0],0>e?-1:0)}function yt(e){if(isNaN(e)||!isFinite(e))return _e;if(0>e)return W(yt(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=ts;return new V(t,0)}function pu(e,t){if(e.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(e.charAt(0)=="-")return W(pu(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=yt(Math.pow(t,8)),r=_e,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),o=parseInt(e.substring(i,i+s),t);8>s?(s=yt(Math.pow(t,s)),r=r.R(s).add(yt(o))):(r=r.R(n),r=r.add(yt(o)))}return r}var ts=4294967296,_e=Ts(0),es=Ts(1),dc=Ts(16777216);_=V.prototype;_.ea=function(){if(ut(this))return-W(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:ts+r)*t,t*=ts}return e};_.toString=function(e){if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(Dt(this))return"0";if(ut(this))return"-"+W(this).toString(e);for(var t=yt(Math.pow(e,6)),n=this,r="";;){var i=cr(n,t).g;n=ar(n,i.R(t));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(e);if(n=i,Dt(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};_.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h};function Dt(e){if(e.h!=0)return!1;for(var t=0;t<e.g.length;t++)if(e.g[t]!=0)return!1;return!0}function ut(e){return e.h==-1}_.X=function(e){return e=ar(this,e),ut(e)?-1:Dt(e)?0:1};function W(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new V(n,~e.h).add(es)}_.abs=function(){return ut(this)?W(this):this};_.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(this.D(i)&65535)+(e.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new V(n,n[n.length-1]&-2147483648?-1:0)};function ar(e,t){return e.add(W(t))}_.R=function(e){if(Dt(this)||Dt(e))return _e;if(ut(this))return ut(e)?W(this).R(W(e)):W(W(this).R(e));if(ut(e))return W(this.R(W(e)));if(0>this.X(dc)&&0>e.X(dc))return yt(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=e.D(i)>>>16,c=e.D(i)&65535;n[2*r+2*i]+=o*c,nr(n,2*r+2*i),n[2*r+2*i+1]+=s*c,nr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,nr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,nr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new V(n,0)};function nr(e,t){for(;(e[t]&65535)!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Xe(e,t){this.g=e,this.h=t}function cr(e,t){if(Dt(t))throw Error("division by zero");if(Dt(e))return new Xe(_e,_e);if(ut(e))return t=cr(W(e),t),new Xe(W(t.g),W(t.h));if(ut(t))return t=cr(e,W(t)),new Xe(W(t.g),t.h);if(30<e.g.length){if(ut(e)||ut(t))throw Error("slowDivide_ only works with positive integers.");for(var n=es,r=t;0>=r.X(e);)n=fc(n),r=fc(r);var i=ge(n,1),s=ge(r,1);for(r=ge(r,2),n=ge(n,2);!Dt(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=ge(r,1),n=ge(n,1)}return t=ar(e,i.R(t)),new Xe(i,t)}for(i=_e;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=yt(n),o=s.R(t);ut(o)||0<o.X(e);)n-=r,s=yt(n),o=s.R(t);Dt(s)&&(s=es),i=i.add(s),e=ar(e,o)}return new Xe(i,e)}_.gb=function(e){return cr(this,e).h};_.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new V(n,this.h&e.h)};_.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new V(n,this.h|e.h)};_.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new V(n,this.h^e.h)};function fc(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new V(n,e.h)}function ge(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new V(i,e.h)}or.prototype.createWebChannel=or.prototype.g;st.prototype.send=st.prototype.u;st.prototype.open=st.prototype.m;st.prototype.close=st.prototype.close;pr.NO_ERROR=0;pr.TIMEOUT=8;pr.HTTP_ERROR=6;Nc.COMPLETE="complete";kc.EventType=fn;fn.OPEN="a";fn.CLOSE="b";fn.ERROR="c";fn.MESSAGE="d";G.prototype.listen=G.prototype.O;M.prototype.listenOnce=M.prototype.P;M.prototype.getLastError=M.prototype.Sa;M.prototype.getLastErrorCode=M.prototype.Ia;M.prototype.getStatus=M.prototype.da;M.prototype.getResponseJson=M.prototype.Wa;M.prototype.getResponseText=M.prototype.ja;M.prototype.send=M.prototype.ha;M.prototype.setWithCredentials=M.prototype.Oa;dt.prototype.digest=dt.prototype.l;dt.prototype.reset=dt.prototype.reset;dt.prototype.update=dt.prototype.j;V.prototype.add=V.prototype.add;V.prototype.multiply=V.prototype.R;V.prototype.modulo=V.prototype.gb;V.prototype.compare=V.prototype.X;V.prototype.toNumber=V.prototype.ea;V.prototype.toString=V.prototype.toString;V.prototype.getBits=V.prototype.D;V.fromNumber=yt;V.fromString=pu;var _u=ft.createWebChannelTransport=function(){return new or},yu=ft.getStatEventTarget=function(){return gr()},Ar=ft.ErrorCode=pr,wu=ft.EventType=Nc,vu=ft.Event=Xt,As=ft.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Pg=ft.FetchXmlHttpFactory=pn,wn=ft.WebChannel=kc,Eu=ft.XhrIo=M,Iu=ft.Md5=dt,Jt=ft.Integer=V;var Tu="@firebase/firestore";var K=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};K.UNAUTHENTICATED=new K(null),K.GOOGLE_CREDENTIALS=new K("google-credentials-uid"),K.FIRST_PARTY=new K("first-party-uid"),K.MOCK_USER=new K("mock-user");var Ue="10.8.0";var ie=new me("@firebase/firestore");function vn(){return ie.logLevel}function y(e,...t){if(ie.logLevel<=D.DEBUG){let n=t.map(ca);ie.debug(`Firestore (${Ue}): ${e}`,...n)}}function Tt(e,...t){if(ie.logLevel<=D.ERROR){let n=t.map(ca);ie.error(`Firestore (${Ue}): ${e}`,...n)}}function Re(e,...t){if(ie.logLevel<=D.WARN){let n=t.map(ca);ie.warn(`Firestore (${Ue}): ${e}`,...n)}}function ca(e){if(typeof e=="string")return e;try{return function(n){return JSON.stringify(n)}(e)}catch{return e}}function I(e="Unexpected state"){let t=`FIRESTORE (${Ue}) INTERNAL ASSERTION FAILED: `+e;throw Tt(t),new Error(t)}function N(e,t){e||I()}function R(e,t){return e}var f={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=class extends Rt{constructor(t,n){super(t,n),this.code=t,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ht=class{constructor(){this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}};var Cr=class{constructor(t,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Cs=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,n){t.enqueueRetryable(()=>n(K.UNAUTHENTICATED))}shutdown(){}},Ds=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,n){this.changeListener=n,t.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},xs=class{constructor(t){this.t=t,this.currentUser=K.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i,i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve(),s=new ht;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ht,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>p(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ht)}},0),o()}getToken(){let t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==t?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(N(typeof r.accessToken=="string"),new Cr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return N(t===null||typeof t=="string"),new K(t)}},Vs=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=K.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Ns=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r}getToken(){return Promise.resolve(new Vs(this.l,this.h,this.P))}start(t,n){t.enqueueRetryable(()=>n(K.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ks=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Os=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,n){let r=s=>{s.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(n=>n?(N(typeof n.token=="string"),this.R=n.token,new ks(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function gf(e){let t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var Dr=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=gf(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=t.charAt(i[s]%t.length))}return r}};function x(e,t){return e<t?-1:e>t?1:0}function Pe(e,t,n){return e.length===t.length&&e.every((r,i)=>n(r,t[i]))}var Y=class e{constructor(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new w(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new w(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new w(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return e.fromMillis(Date.now())}static fromDate(t){return e.fromMillis(t.getTime())}static fromMillis(t){let n=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*n));return new e(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?x(this.nanoseconds,t.nanoseconds):x(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var b=class e{constructor(t){this.timestamp=t}static fromTimestamp(t){return new e(t)}static min(){return new e(new Y(0,0))}static max(){return new e(new Y(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var xr=class e{constructor(t,n,r){n===void 0?n=0:n>t.length&&I(),r===void 0?r=t.length-n:r>t.length-n&&I(),this.segments=t,this.offset=n,this.len=r}get length(){return this.len}isEqual(t){return e.comparator(this,t)===0}child(t){let n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(r=>{n.push(r)}):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}forEach(t){for(let n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){let r=Math.min(t.length,n.length);for(let i=0;i<r;i++){let s=t.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<n.length?-1:t.length>n.length?1:0}},F=class e extends xr{construct(t,n,r){return new e(t,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let n=[];for(let r of t){if(r.indexOf("//")>=0)throw new w(f.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new e(n)}static emptyPath(){return new e([])}},pf=/^[_a-zA-Z][_a-zA-Z0-9]*$/,at=class e extends xr{construct(t,n,r){return new e(t,n,r)}static isValidIdentifier(t){return pf.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new e(["__name__"])}static fromServerFormat(t){let n=[],r="",i=0,s=()=>{if(r.length===0)throw new w(f.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;i<t.length;){let a=t[i];if(a==="\\"){if(i+1===t.length)throw new w(f.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new w(f.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new w(f.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)}static emptyPath(){return new e([])}};var E=class e{constructor(t){this.path=t}static fromPath(t){return new e(F.fromString(t))}static fromName(t){return new e(F.fromString(t).popFirst(5))}static empty(){return new e(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&F.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,n){return F.comparator(t.path,n.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new e(new F(t.slice()))}};var Ms=class{constructor(t,n,r,i){this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}};Ms.UNKNOWN_ID=-1;function _f(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=b.fromTimestamp(r===1e9?new Y(n+1,0):new Y(n,r));return new se(i,E.empty(),t)}function yf(e){return new se(e.readTime,e.key,-1)}var se=class e{constructor(t,n,r){this.readTime=t,this.documentKey=n,this.largestBatchId=r}static min(){return new e(b.min(),E.empty(),-1)}static max(){return new e(b.max(),E.empty(),-1)}};function wf(e,t){let n=e.readTime.compareTo(t.readTime);return n!==0?n:(n=E.comparator(e.documentKey,t.documentKey),n!==0?n:x(e.largestBatchId,t.largestBatchId))}var vf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ls=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ln(e){return p(this,null,function*(){if(e.code!==f.FAILED_PRECONDITION||e.message!==vf)throw e;y("LocalStore","Unexpectedly lost primary lease")})}var g=class e{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(t){return this.next(void 0,t)}next(t,n){return this.callbackAttached&&I(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((t,n)=>{this.next(t,n)})}wrapUserFunction(t){try{let n=t();return n instanceof e?n:e.resolve(n)}catch(n){return e.reject(n)}}wrapSuccess(t,n){return t?this.wrapUserFunction(()=>t(n)):e.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction(()=>t(n)):e.reject(n)}static resolve(t){return new e((n,r)=>{n(t)})}static reject(t){return new e((n,r)=>{r(t)})}static waitFor(t){return new e((n,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},c=>r(c))}),o=!0,s===i&&n()})}static or(t){let n=e.resolve(!1);for(let r of t)n=n.next(i=>i?e.resolve(i):r());return n}static forEach(t,n){let r=[];return t.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(t,n){return new e((r,i)=>{let s=t.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;n(t[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,n){return new e((r,i)=>{let s=()=>{t()===!0?n().next(()=>{s()},i):r()};s()})}};var Fs=class e{constructor(t,n){this.action=t,this.transaction=n,this.aborted=!1,this.V=new ht,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new re(t,n.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=ua(r.target.error);this.V.reject(new re(t,i))}}static open(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(s){throw new re(n,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let n=this.transaction.objectStore(t);return new qs(n)}},Vr=class e{constructor(t,n,r){this.name=t,this.version=n,this.p=r,e.S(Ke())===12.2&&Tt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return y("SimpleDb","Removing database:",t),Zt(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!Kn())return!1;if(e.C())return!0;let t=Ke(),n=e.S(t),r=0<n&&n<10,i=e.v(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,n){return t.store(n)}static S(t){let n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){let n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){return p(this,null,function*(){return this.db||(y("SimpleDb","Opening database:",this.name),this.db=yield new Promise((n,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;n(o)},i.onblocked=()=>{r(new re(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new w(f.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new w(f.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new re(t,o))},i.onupgradeneeded=s=>{y("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{y("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=n=>this.B(n)),this.db})}L(t){this.B=t,this.db&&(this.db.onversionchange=n=>t(n))}runTransaction(t,n,r,i){return p(this,null,function*(){let s=n==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=Fs.open(this.db,t,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),g.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Bs=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Zt(this.k.delete())}},re=class extends w{constructor(t,n){super(f.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${n}`),this.name="IndexedDbTransactionError"}};function Fn(e){return e.name==="IndexedDbTransactionError"}var qs=class{constructor(t){this.store=t}put(t,n){let r;return n!==void 0?(y("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Zt(r)}add(t){return y("SimpleDb","ADD",this.store.name,t,t),Zt(this.store.add(t))}get(t){return Zt(this.store.get(t)).next(n=>(n===void 0&&(n=null),y("SimpleDb","GET",this.store.name,t,n),n))}delete(t){return y("SimpleDb","DELETE",this.store.name,t),Zt(this.store.delete(t))}count(){return y("SimpleDb","COUNT",this.store.name),Zt(this.store.count())}W(t,n){let r=this.options(t,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new g((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(t,n){let r=this.store.getAll(t,n===null?void 0:n);return new g((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(t,n){y("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,n);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(t,n){let r;n?r=t:(r={},n=t);let i=this.cursor(r);return this.G(i,n)}Z(t){let n=this.cursor({});return new g((r,i)=>{n.onerror=s=>{let o=ua(s.target.error);i(o)},n.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,n){let r=[];return new g((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new Bs(a),u=n(a.primaryKey,a.value,c);if(u instanceof g){let l=u.catch(h=>(c.done(),g.reject(h)));r.push(l)}c.isDone?i():c.$===null?a.continue():a.continue(c.$)}}).next(()=>g.waitFor(r))}options(t,n){let r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}}cursor(t){let n="next";if(t.reverse&&(n="prev"),t.index){let r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)}};function Zt(e){return new g((t,n)=>{e.onsuccess=r=>{let i=r.target.result;t(i)},e.onerror=r=>{let i=ua(r.target.error);n(i)}})}var Au=!1;function ua(e){let t=Vr.S(Ke());if(t>=12.2&&t<13){let n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){let r=new w("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Au||(Au=!0,setTimeout(()=>{throw r},0)),r}}return e}var Xu=(()=>{class e{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.oe&&this.oe(n),n}}return e._e=-1,e})();function ui(e){return e==null}function bn(e){return e===0&&1/e==-1/0}function Ef(e){return typeof e=="number"&&Number.isInteger(e)&&!bn(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var If=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Bg=[...If,"documentOverlays"],Tf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Af=Tf,qg=[...Af,"indexConfiguration","indexState","indexEntries"];function Su(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function le(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ju(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var B=class e{constructor(t,n){this.comparator=t,this.root=n||vt.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,vt.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,vt.BLACK,null,null))}get(t){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(t){let n=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((n,r)=>(t(n,r),!1))}toString(){let t=[];return this.inorderTraversal((n,r)=>(t.push(`${n}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ae(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ae(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ae(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ae(this.root,t,this.comparator,!0)}},Ae=class{constructor(t,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=n?r(t.key,n):1,n&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},vt=class e{constructor(t,n,r,i,s){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??e.EMPTY,this.right=s??e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,i,s){return new e(t??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw I();let t=this.left.check();if(t!==this.right.check())throw I();return t+(this.isRed()?0:1)}};vt.EMPTY=null,vt.RED=!0,vt.BLACK=!1;vt.EMPTY=new class{constructor(){this.size=0}get key(){throw I()}get value(){throw I()}get color(){throw I()}get left(){throw I()}get right(){throw I()}copy(t,n,r,i,s){return this}insert(t,n,r){return new vt(t,n)}remove(t,n){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var tt=class e{constructor(t){this.comparator=t,this.data=new B(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((n,r)=>(t(n),!1))}forEachInRange(t,n){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}}forEachWhile(t,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null}getIterator(){return new Nr(this.data.getIterator())}getIteratorFrom(t){return new Nr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let n=this;return n.size<t.size&&(n=t,t=this),t.forEach(r=>{n=n.add(r)}),n}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(n=>{t.push(n)}),t}toString(){let t=[];return this.forEach(n=>t.push(n)),"SortedSet("+t.toString()+")"}copy(t){let n=new e(this.comparator);return n.data=t,n}},Nr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var lt=class e{constructor(t){this.fields=t,t.sort(at.comparator)}static empty(){return new e([])}unionWith(t){let n=new tt(at.comparator);for(let r of this.fields)n=n.add(r);for(let r of t)n=n.add(r);return new e(n.toArray())}covers(t){for(let n of this.fields)if(n.isPrefixOf(t))return!0;return!1}isEqual(t){return Pe(this.fields,t.fields,(n,r)=>n.isEqual(r))}};var kr=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var nt=class e{constructor(t){this.binaryString=t}static fromBase64String(t){let n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new kr("Invalid base64 string: "+s):s}}(t);return new e(n)}static fromUint8Array(t){let n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new e(n)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return x(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};nt.EMPTY_BYTE_STRING=new nt("");var Sf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qt(e){if(N(!!e),typeof e=="string"){let t=0,n=Sf.exec(e);if(N(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:L(e.seconds),nanos:L(e.nanos)}}function L(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Ut(e){return typeof e=="string"?nt.fromBase64String(e):nt.fromUint8Array(e)}function la(e){var t,n;return((n=(((t=e?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function ha(e){let t=e.mapValue.fields.__previous_value__;return la(t)?ha(t):t}function Rn(e){let t=qt(e.mapValue.fields.__local_write_time__.timestampValue);return new Y(t.seconds,t.nanos)}var Us=class{constructor(t,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},Or=class e{constructor(t,n){this.projectId=t,this.database=n||"(default)"}static empty(){return new e("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}};var Sr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function oe(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?la(e)?4:Zu(e)?9007199254740991:10:I()}function At(e,t){if(e===t)return!0;let n=oe(e);if(n!==oe(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Rn(e).isEqual(Rn(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=qt(i.timestampValue),a=qt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(i,s){return Ut(i.bytesValue).isEqual(Ut(s.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(i,s){return L(i.geoPointValue.latitude)===L(s.geoPointValue.latitude)&&L(i.geoPointValue.longitude)===L(s.geoPointValue.longitude)}(e,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return L(i.integerValue)===L(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=L(i.doubleValue),a=L(s.doubleValue);return o===a?bn(o)===bn(a):isNaN(o)&&isNaN(a)}return!1}(e,t);case 9:return Pe(e.arrayValue.values||[],t.arrayValue.values||[],At);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Su(o)!==Su(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!At(o[c],a[c])))return!1;return!0}(e,t);default:return I()}}function Pn(e,t){return(e.values||[]).find(n=>At(n,t))!==void 0}function Ce(e,t){if(e===t)return 0;let n=oe(e),r=oe(t);if(n!==r)return x(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return x(e.booleanValue,t.booleanValue);case 2:return function(s,o){let a=L(s.integerValue||s.doubleValue),c=L(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(e,t);case 3:return bu(e.timestampValue,t.timestampValue);case 4:return bu(Rn(e),Rn(t));case 5:return x(e.stringValue,t.stringValue);case 6:return function(s,o){let a=Ut(s),c=Ut(o);return a.compareTo(c)}(e.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=x(a[u],c[u]);if(l!==0)return l}return x(a.length,c.length)}(e.referenceValue,t.referenceValue);case 8:return function(s,o){let a=x(L(s.latitude),L(o.latitude));return a!==0?a:x(L(s.longitude),L(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=Ce(a[u],c[u]);if(l)return l}return x(a.length,c.length)}(e.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Sr.mapValue&&o===Sr.mapValue)return 0;if(s===Sr.mapValue)return 1;if(o===Sr.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){let d=x(c[h],l[h]);if(d!==0)return d;let m=Ce(a[c[h]],u[l[h]]);if(m!==0)return m}return x(c.length,l.length)}(e.mapValue,t.mapValue);default:throw I()}}function bu(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return x(e,t);let n=qt(e),r=qt(t),i=x(n.seconds,r.seconds);return i!==0?i:x(n.nanos,r.nanos)}function De(e){return zs(e)}function zs(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(n){let r=qt(n);return`time(${r.seconds},${r.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(n){return Ut(n).toBase64()}(e.bytesValue):"referenceValue"in e?function(n){return E.fromName(n).toString()}(e.referenceValue):"geoPointValue"in e?function(n){return`geo(${n.latitude},${n.longitude})`}(e.geoPointValue):"arrayValue"in e?function(n){let r="[",i=!0;for(let s of n.values||[])i?i=!1:r+=",",r+=zs(s);return r+"]"}(e.arrayValue):"mapValue"in e?function(n){let r=Object.keys(n.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${zs(n.fields[o])}`;return i+"}"}(e.mapValue):I()}function js(e){return!!e&&"integerValue"in e}function da(e){return!!e&&"arrayValue"in e}function Ru(e){return!!e&&"nullValue"in e}function Pu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Rr(e){return!!e&&"mapValue"in e}function In(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return le(e.mapValue.fields,(n,r)=>t.mapValue.fields[n]=In(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=In(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Zu(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var ot=class e{constructor(t){this.value=t}static empty(){return new e({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let n=this.value;for(let r=0;r<t.length-1;++r)if(n=(n.mapValue.fields||{})[t.get(r)],!Rr(n))return null;return n=(n.mapValue.fields||{})[t.lastSegment()],n||null}}set(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=In(n)}setAll(t){let n=at.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=In(o):i.push(a.lastSegment())});let s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(t){let n=this.field(t.popLast());Rr(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]}isEqual(t){return At(this.value,t.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=n.mapValue.fields[t.get(r)];Rr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(t,n,r){le(n,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new e(In(this.value))}};function tl(e){let t=[];return le(e.fields,(n,r)=>{let i=new at([n]);if(Rr(r)){let s=tl(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new lt(t)}var mt=class e{constructor(t,n,r,i,s,o,a){this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new e(t,0,b.min(),b.min(),b.min(),ot.empty(),0)}static newFoundDocument(t,n,r,i){return new e(t,1,n,b.min(),r,i,0)}static newNoDocument(t,n){return new e(t,2,n,b.min(),b.min(),ot.empty(),0)}static newUnknownDocument(t,n){return new e(t,3,n,b.min(),b.min(),ot.empty(),2)}convertToFoundDocument(t,n){return!this.createTime.isEqual(b.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ot.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=b.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var xe=class{constructor(t,n){this.position=t,this.inclusive=n}};function Cu(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(s.field.isKeyField()?r=E.comparator(E.fromName(o.referenceValue),n.key):r=Ce(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Du(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!At(e.position[n],t.position[n]))return!1;return!0}var Ve=class{constructor(t,n="asc"){this.field=t,this.dir=n}};function bf(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Mr=class{},j=class e extends Mr{constructor(t,n,r){super(),this.field=t,this.op=n,this.value=r}static create(t,n,r){return t.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(t,n,r):new $s(t,n,r):n==="array-contains"?new Ws(t,r):n==="in"?new Hs(t,r):n==="not-in"?new Ys(t,r):n==="array-contains-any"?new Xs(t,r):new e(t,n,r)}static createKeyFieldInFilter(t,n,r){return n==="in"?new Ks(t,r):new Qs(t,r)}matches(t){let n=t.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Ce(n,this.value)):n!==null&&oe(this.value)===oe(n)&&this.matchesComparison(Ce(n,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return I()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},St=class e extends Mr{constructor(t,n){super(),this.filters=t,this.op=n,this.ue=null}static create(t,n){return new e(t,n)}matches(t){return el(this)?this.filters.find(n=>!n.matches(t))===void 0:this.filters.find(n=>n.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,n)=>t.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function el(e){return e.op==="and"}function nl(e){return Rf(e)&&el(e)}function Rf(e){for(let t of e.filters)if(t instanceof St)return!1;return!0}function Gs(e){if(e instanceof j)return e.field.canonicalString()+e.op.toString()+De(e.value);if(nl(e))return e.filters.map(t=>Gs(t)).join(",");{let t=e.filters.map(n=>Gs(n)).join(",");return`${e.op}(${t})`}}function rl(e,t){return e instanceof j?function(r,i){return i instanceof j&&r.op===i.op&&r.field.isEqual(i.field)&&At(r.value,i.value)}(e,t):e instanceof St?function(r,i){return i instanceof St&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&rl(o,i.filters[a]),!0):!1}(e,t):void I()}function il(e){return e instanceof j?function(n){return`${n.field.canonicalString()} ${n.op} ${De(n.value)}`}(e):e instanceof St?function(n){return n.op.toString()+" {"+n.getFilters().map(il).join(" ,")+"}"}(e):"Filter"}var $s=class extends j{constructor(t,n,r){super(t,n,r),this.key=E.fromName(r.referenceValue)}matches(t){let n=E.comparator(t.key,this.key);return this.matchesComparison(n)}},Ks=class extends j{constructor(t,n){super(t,"in",n),this.keys=sl("in",n)}matches(t){return this.keys.some(n=>n.isEqual(t.key))}},Qs=class extends j{constructor(t,n){super(t,"not-in",n),this.keys=sl("not-in",n)}matches(t){return!this.keys.some(n=>n.isEqual(t.key))}};function sl(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>E.fromName(r.referenceValue))}var Ws=class extends j{constructor(t,n){super(t,"array-contains",n)}matches(t){let n=t.data.field(this.field);return da(n)&&Pn(n.arrayValue,this.value)}},Hs=class extends j{constructor(t,n){super(t,"in",n)}matches(t){let n=t.data.field(this.field);return n!==null&&Pn(this.value.arrayValue,n)}},Ys=class extends j{constructor(t,n){super(t,"not-in",n)}matches(t){if(Pn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=t.data.field(this.field);return n!==null&&!Pn(this.value.arrayValue,n)}},Xs=class extends j{constructor(t,n){super(t,"array-contains-any",n)}matches(t){let n=t.data.field(this.field);return!(!da(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Pn(this.value.arrayValue,r))}};var Js=class{constructor(t,n=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function xu(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Js(e,t,n,r,i,s,o)}function fa(e){let t=R(e);if(t.ce===null){let n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(r=>Gs(r)).join(","),n+="|ob:",n+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ui(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>De(r)).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>De(r)).join(",")),t.ce=n}return t.ce}function ma(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!bf(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!rl(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Du(e.startAt,t.startAt)&&Du(e.endAt,t.endAt)}function Zs(e){return E.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var Ne=class{constructor(t,n=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Pf(e,t,n,r,i,s,o,a){return new Ne(e,t,n,r,i,s,o,a)}function ga(e){return new Ne(e)}function Vu(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function Cf(e){return e.collectionGroup!==null}function Tn(e){let t=R(e);if(t.le===null){t.le=[];let n=new Set;for(let s of t.explicitOrderBy)t.le.push(s),n.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new tt(at.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(t).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||t.le.push(new Ve(s,r))}),n.has(at.keyField().canonicalString())||t.le.push(new Ve(at.keyField(),r))}return t.le}function Et(e){let t=R(e);return t.he||(t.he=Df(t,Tn(e))),t.he}function Df(e,t){if(e.limitType==="F")return xu(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ve(i.field,s)});let n=e.endAt?new xe(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new xe(e.startAt.position,e.startAt.inclusive):null;return xu(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function to(e,t,n){return new Ne(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function li(e,t){return ma(Et(e),Et(t))&&e.limitType===t.limitType}function ol(e){return`${fa(Et(e))}|lt:${e.limitType}`}function Ee(e){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>il(i)).join(", ")}]`),ui(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>De(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>De(i)).join(",")),`Target(${r})`}(Et(e))}; limitType=${e.limitType})`}function hi(e,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):E.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(e,t)&&function(r,i){for(let s of Tn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(e,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(e,t)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=Cu(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,Tn(r),i)||r.endAt&&!function(o,a,c){let u=Cu(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,Tn(r),i))}(e,t)}function xf(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function al(e){return(t,n)=>{let r=!1;for(let i of Tn(e)){let s=Vf(i,t,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Vf(e,t,n){let r=e.field.isKeyField()?E.comparator(t.key,n.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?Ce(c,u):I()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return I()}}var zt=class{constructor(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}get(t){let n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,n){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,n]);i.push([t,n]),this.innerSize++}delete(t){let n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){le(this.inner,(n,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return Ju(this.inner)}size(){return this.innerSize}};var Nf=new B(E.comparator);function Nt(){return Nf}var cl=new B(E.comparator);function En(...e){let t=cl;for(let n of e)t=t.insert(n.key,n);return t}function ul(e){let t=cl;return e.forEach((n,r)=>t=t.insert(n,r.overlayedDocument)),t}function te(){return An()}function ll(){return An()}function An(){return new zt(e=>e.toString(),(e,t)=>e.isEqual(t))}var kf=new B(E.comparator),Of=new tt(E.comparator);function P(...e){let t=Of;for(let n of e)t=t.add(n);return t}var Mf=new tt(x);function Lf(){return Mf}function hl(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bn(t)?"-0":t}}function dl(e){return{integerValue:""+e}}function Ff(e,t){return Ef(t)?dl(t):hl(e,t)}var ke=class{constructor(){this._=void 0}};function Bf(e,t,n){return e instanceof Oe?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&la(s)&&(s=ha(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,t):e instanceof ae?ml(e,t):e instanceof ce?gl(e,t):function(i,s){let o=fl(i,s),a=Nu(o)+Nu(i.Ie);return js(o)&&js(i.Ie)?dl(a):hl(i.serializer,a)}(e,t)}function qf(e,t,n){return e instanceof ae?ml(e,t):e instanceof ce?gl(e,t):n}function fl(e,t){return e instanceof Me?function(r){return js(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var Oe=class extends ke{},ae=class extends ke{constructor(t){super(),this.elements=t}};function ml(e,t){let n=pl(t);for(let r of e.elements)n.some(i=>At(i,r))||n.push(r);return{arrayValue:{values:n}}}var ce=class extends ke{constructor(t){super(),this.elements=t}};function gl(e,t){let n=pl(t);for(let r of e.elements)n=n.filter(i=>!At(i,r));return{arrayValue:{values:n}}}var Me=class extends ke{constructor(t,n){super(),this.serializer=t,this.Ie=n}};function Nu(e){return L(e.integerValue||e.doubleValue)}function pl(e){return da(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}function Uf(e,t){return e.field.isEqual(t.field)&&function(r,i){return r instanceof ae&&i instanceof ae||r instanceof ce&&i instanceof ce?Pe(r.elements,i.elements,At):r instanceof Me&&i instanceof Me?At(r.Ie,i.Ie):r instanceof Oe&&i instanceof Oe}(e.transform,t.transform)}var eo=class{constructor(t,n){this.version=t,this.transformResults=n}},Vt=class e{constructor(t,n){this.updateTime=t,this.exists=n}static none(){return new e}static exists(t){return new e(void 0,t)}static updateTime(t){return new e(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Pr(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var Le=class{};function _l(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new Cn(e.key,Vt.none()):new ue(e.key,e.data,Vt.none());{let n=e.data,r=ot.empty(),i=new tt(at.comparator);for(let s of t.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new bt(e.key,r,new lt(i.toArray()),Vt.none())}}function zf(e,t,n){e instanceof ue?function(i,s,o){let a=i.value.clone(),c=Ou(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(e,t,n):e instanceof bt?function(i,s,o){if(!Pr(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Ou(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(yl(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(e,t,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function Sn(e,t,n,r){return e instanceof ue?function(s,o,a,c){if(!Pr(s.precondition,o))return a;let u=s.value.clone(),l=Mu(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(e,t,n,r):e instanceof bt?function(s,o,a,c){if(!Pr(s.precondition,o))return a;let u=Mu(s.fieldTransforms,c,o),l=o.data;return l.setAll(yl(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(e,t,n,r):function(s,o,a){return Pr(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(e,t,n)}function jf(e,t){let n=null;for(let r of e.fieldTransforms){let i=t.data.field(r.field),s=fl(r.transform,i||null);s!=null&&(n===null&&(n=ot.empty()),n.set(r.field,s))}return n||null}function ku(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Pe(r,i,(s,o)=>Uf(s,o))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var ue=class extends Le{constructor(t,n,r,i=[]){super(),this.key=t,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},bt=class extends Le{constructor(t,n,r,i,s=[]){super(),this.key=t,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function yl(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function Ou(e,t,n){let r=new Map;N(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,qf(o,a,n[i]))}return r}function Mu(e,t,n){let r=new Map;for(let i of e){let s=i.transform,o=n.data.field(i.field);r.set(i.field,Bf(s,o,t))}return r}var Cn=class extends Le{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},no=class extends Le{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ro=class{constructor(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,n){let r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&zf(s,t,r[i])}}applyToLocalView(t,n){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(n=Sn(r,t,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(n=Sn(r,t,n,this.localWriteTime));return n}applyToLocalDocumentSet(t,n){let r=ll();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;let c=_l(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(b.min())}),r}keys(){return this.mutations.reduce((t,n)=>t.add(n.key),P())}isEqual(t){return this.batchId===t.batchId&&Pe(this.mutations,t.mutations,(n,r)=>ku(n,r))&&Pe(this.baseMutations,t.baseMutations,(n,r)=>ku(n,r))}},io=class e{constructor(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(t,n,r){N(t.mutations.length===r.length);let i=function(){return kf}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new e(t,n,r,i)}};var so=class{constructor(t,n){this.largestBatchId=t,this.mutation=n}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var oo=class{constructor(t,n){this.count=t,this.unchangedNames=n}};var U,C;function Gf(e){switch(e){default:return I();case f.CANCELLED:case f.UNKNOWN:case f.DEADLINE_EXCEEDED:case f.RESOURCE_EXHAUSTED:case f.INTERNAL:case f.UNAVAILABLE:case f.UNAUTHENTICATED:return!1;case f.INVALID_ARGUMENT:case f.NOT_FOUND:case f.ALREADY_EXISTS:case f.PERMISSION_DENIED:case f.FAILED_PRECONDITION:case f.ABORTED:case f.OUT_OF_RANGE:case f.UNIMPLEMENTED:case f.DATA_LOSS:return!0}}function wl(e){if(e===void 0)return Tt("GRPC error has no .code"),f.UNKNOWN;switch(e){case U.OK:return f.OK;case U.CANCELLED:return f.CANCELLED;case U.UNKNOWN:return f.UNKNOWN;case U.DEADLINE_EXCEEDED:return f.DEADLINE_EXCEEDED;case U.RESOURCE_EXHAUSTED:return f.RESOURCE_EXHAUSTED;case U.INTERNAL:return f.INTERNAL;case U.UNAVAILABLE:return f.UNAVAILABLE;case U.UNAUTHENTICATED:return f.UNAUTHENTICATED;case U.INVALID_ARGUMENT:return f.INVALID_ARGUMENT;case U.NOT_FOUND:return f.NOT_FOUND;case U.ALREADY_EXISTS:return f.ALREADY_EXISTS;case U.PERMISSION_DENIED:return f.PERMISSION_DENIED;case U.FAILED_PRECONDITION:return f.FAILED_PRECONDITION;case U.ABORTED:return f.ABORTED;case U.OUT_OF_RANGE:return f.OUT_OF_RANGE;case U.UNIMPLEMENTED:return f.UNIMPLEMENTED;case U.DATA_LOSS:return f.DATA_LOSS;default:return I()}}(C=U||(U={}))[C.OK=0]="OK",C[C.CANCELLED=1]="CANCELLED",C[C.UNKNOWN=2]="UNKNOWN",C[C.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",C[C.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",C[C.NOT_FOUND=5]="NOT_FOUND",C[C.ALREADY_EXISTS=6]="ALREADY_EXISTS",C[C.PERMISSION_DENIED=7]="PERMISSION_DENIED",C[C.UNAUTHENTICATED=16]="UNAUTHENTICATED",C[C.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",C[C.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",C[C.ABORTED=10]="ABORTED",C[C.OUT_OF_RANGE=11]="OUT_OF_RANGE",C[C.UNIMPLEMENTED=12]="UNIMPLEMENTED",C[C.INTERNAL=13]="INTERNAL",C[C.UNAVAILABLE=14]="UNAVAILABLE",C[C.DATA_LOSS=15]="DATA_LOSS";var Lu=null;function $f(){return new TextEncoder}var Kf=new Jt([4294967295,4294967295],0);function Fu(e){let t=$f().encode(e),n=new Iu;return n.update(t),new Uint8Array(n.digest())}function Bu(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Jt([n,r],0),new Jt([i,s],0)]}var ao=class e{constructor(t,n,r){if(this.bitmap=t,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ee(`Invalid padding: ${n}`);if(r<0)throw new ee(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new ee(`Invalid hash count: ${r}`);if(t.length===0&&n!==0)throw new ee(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*t.length-n,this.Ee=Jt.fromNumber(this.Te)}de(t,n,r){let i=t.add(n.multiply(Jt.fromNumber(r)));return i.compare(Kf)===1&&(i=new Jt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let n=Fu(t),[r,i]=Bu(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(t,n,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new e(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let n=Fu(t),[r,i]=Bu(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(t){let n=Math.floor(t/8),r=t%8;this.bitmap[n]|=1<<r}},ee=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Lr=class e{constructor(t,n,r,i,s){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,n,r){let i=new Map;return i.set(t,Dn.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(b.min(),i,new B(x),Nt(),P())}},Dn=class e{constructor(t,n,r,i,s){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,n,r){return new e(r,n,P(),P(),P())}};var Se=class{constructor(t,n,r,i){this.Ve=t,this.removedTargetIds=n,this.key=r,this.me=i}},Fr=class{constructor(t,n){this.targetId=t,this.fe=n}},Br=class{constructor(t,n,r=nt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i}},qr=class{constructor(){this.ge=0,this.pe=Uu(),this.ye=nt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=P(),n=P(),r=P();return this.pe.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:I()}}),new Dn(this.ye,this.we,t,n,r)}Fe(){this.Se=!1,this.pe=Uu()}Me(t,n){this.Se=!0,this.pe=this.pe.insert(t,n)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,N(this.ge>=0)}Be(){this.Se=!0,this.we=!0}},co=class{constructor(t){this.Le=t,this.ke=new Map,this.qe=Nt(),this.Qe=qu(),this.Ke=new B(x)}$e(t){for(let n of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(n,t.me):this.We(n,t.key,t.me);for(let n of t.removedTargetIds)this.We(n,t.key,t.me)}Ge(t){this.forEachTarget(t,n=>{let r=this.ze(n);switch(t.state){case 0:this.je(n)&&r.Ce(t.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(t.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(n);break;case 3:this.je(n)&&(r.Be(),r.Ce(t.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.Ce(t.resumeToken));break;default:I()}})}forEachTarget(t,n){t.targetIds.length>0?t.targetIds.forEach(n):this.ke.forEach((r,i)=>{this.je(i)&&n(i)})}Je(t){let n=t.targetId,r=t.fe.count,i=this.Ye(n);if(i){let s=i.target;if(Zs(s))if(r===0){let o=new E(s.path);this.We(n,o,mt.newNoDocument(o,b.min()))}else N(r===1);else{let o=this.Ze(n);if(o!==r){let a=this.Xe(t),c=a?this.et(a,t,o):1;if(c!==0){this.He(n);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,u)}Lu?.tt(function(l,h,d,m,A){var S,v,k,q,Q,it;let $t={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},rt=h.unchangedNames;return rt&&($t.bloomFilter={applied:A===0,hashCount:(S=rt?.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(q=(k=(v=rt?.bits)===null||v===void 0?void 0:v.bitmap)===null||k===void 0?void 0:k.length)!==null&&q!==void 0?q:0,padding:(it=(Q=rt?.bits)===null||Q===void 0?void 0:Q.padding)!==null&&it!==void 0?it:0,mightContain:de=>{var zn;return(zn=m?.mightContain(de))!==null&&zn!==void 0&&zn}}),$t}(o,t.fe,this.Le.nt(),a,c))}}}}Xe(t){let n=t.fe.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n,o,a;try{o=Ut(r).toUint8Array()}catch(c){if(c instanceof kr)return Re("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new ao(o,i,s)}catch(c){return Re(c instanceof ee?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(t,n,r){return n.fe.count===r-this.rt(t,n.targetId)?0:2}rt(t,n){let r=this.Le.getRemoteKeysForTarget(n),i=0;return r.forEach(s=>{let o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(n,s,null),i++)}),i}it(t){let n=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&Zs(a.target)){let c=new E(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,mt.newNoDocument(c,t))}s.De&&(n.set(o,s.ve()),s.Fe())}});let r=P();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));let i=new Lr(t,n,this.Ke,this.qe,r);return this.qe=Nt(),this.Qe=qu(),this.Ke=new B(x),i}Ue(t,n){if(!this.je(t))return;let r=this.st(t,n.key)?2:0;this.ze(t).Me(n.key,r),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(t))}We(t,n,r){if(!this.je(t))return;let i=this.ze(t);this.st(t,n)?i.Me(n,1):i.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(t)),r&&(this.qe=this.qe.insert(n,r))}removeTarget(t){this.ke.delete(t)}Ze(t){let n=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let n=this.ke.get(t);return n||(n=new qr,this.ke.set(t,n)),n}ot(t){let n=this.Qe.get(t);return n||(n=new tt(x),this.Qe=this.Qe.insert(t,n)),n}je(t){let n=this.Ye(t)!==null;return n||y("WatchChangeAggregator","Detected inactive target",t),n}Ye(t){let n=this.ke.get(t);return n&&n.be?null:this.Le._t(t)}He(t){this.ke.set(t,new qr),this.Le.getRemoteKeysForTarget(t).forEach(n=>{this.We(t,n,null)})}st(t,n){return this.Le.getRemoteKeysForTarget(t).has(n)}};function qu(){return new B(E.comparator)}function Uu(){return new B(E.comparator)}var Qf={asc:"ASCENDING",desc:"DESCENDING"},Wf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Hf={and:"AND",or:"OR"},uo=class{constructor(t,n){this.databaseId=t,this.useProto3Json=n}};function lo(e,t){return e.useProto3Json||ui(t)?t:{value:t}}function Ur(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function vl(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Yf(e,t){return Ur(e,t.toTimestamp())}function It(e){return N(!!e),b.fromTimestamp(function(n){let r=qt(n);return new Y(r.seconds,r.nanos)}(e))}function pa(e,t){return ho(e,t).canonicalString()}function ho(e,t){let n=function(i){return new F(["projects",i.projectId,"databases",i.database])}(e).child("documents");return t===void 0?n:n.child(t)}function El(e){let t=F.fromString(e);return N(bl(t)),t}function fo(e,t){return pa(e.databaseId,t.path)}function Ss(e,t){let n=El(t);if(n.get(1)!==e.databaseId.projectId)throw new w(f.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new w(f.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new E(Tl(n))}function Il(e,t){return pa(e.databaseId,t)}function Xf(e){let t=El(e);return t.length===4?F.emptyPath():Tl(t)}function mo(e){return new F(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Tl(e){return N(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function zu(e,t,n){return{name:fo(e,t),fields:n.value.mapValue.fields}}function Jf(e,t){let n;if("targetChange"in t){t.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:I()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?(N(l===void 0||typeof l=="string"),nt.fromBase64String(l||"")):(N(l===void 0||l instanceof Uint8Array),nt.fromUint8Array(l||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(u){let l=u.code===void 0?f.UNKNOWN:wl(u.code);return new w(l,u.message||"")}(o);n=new Br(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ss(e,r.document.name),s=It(r.document.updateTime),o=r.document.createTime?It(r.document.createTime):b.min(),a=new ot({mapValue:{fields:r.document.fields}}),c=mt.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Se(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=Ss(e,r.document),s=r.readTime?It(r.readTime):b.min(),o=mt.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Se([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=Ss(e,r.document),s=r.removedTargetIds||[];n=new Se([],s,i,null)}else{if(!("filter"in t))return I();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new oo(i,s),a=r.targetId;n=new Fr(a,o)}}return n}function Zf(e,t){let n;if(t instanceof ue)n={update:zu(e,t.key,t.value)};else if(t instanceof Cn)n={delete:fo(e,t.key)};else if(t instanceof bt)n={update:zu(e,t.key,t.data),updateMask:cm(t.fieldMask)};else{if(!(t instanceof no))return I();n={verify:fo(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Oe)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ae)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ce)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Me)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw I()}(0,r))),t.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Yf(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:I()}(e,t.precondition)),n}function tm(e,t){return e&&e.length>0?(N(t!==void 0),e.map(n=>function(i,s){let o=i.updateTime?It(i.updateTime):It(s);return o.isEqual(b.min())&&(o=It(s)),new eo(o,i.transformResults||[])}(n,t))):[]}function em(e,t){return{documents:[Il(e,t.path)]}}function nm(e,t){let n={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Il(e,i);let s=function(u){if(u.length!==0)return Sl(St.create(u,"and"))}(t.filters);s&&(n.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(l=>function(d){return{field:Ie(d.field),direction:sm(d.dir)}}(l))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);let a=lo(e,t.limit);return a!==null&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(t.endAt)),{ut:n,parent:i}}function rm(e){let t=Xf(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){N(r===1);let l=n.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];n.where&&(s=function(h){let d=Al(h);return d instanceof St&&nl(d)?d.getFilters():[d]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(d=>function(A){return new Ve(Te(A.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(d))}(n.orderBy));let a=null;n.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,ui(d)?null:d}(n.limit));let c=null;n.startAt&&(c=function(h){let d=!!h.before,m=h.values||[];return new xe(m,d)}(n.startAt));let u=null;return n.endAt&&(u=function(h){let d=!h.before,m=h.values||[];return new xe(m,d)}(n.endAt)),Pf(t,i,o,s,a,"F",c,u)}function im(e,t){let n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return I()}}(t.purpose);return n==null?null:{"goog-listen-tags":n}}function Al(e){return e.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=Te(n.unaryFilter.field);return j.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Te(n.unaryFilter.field);return j.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Te(n.unaryFilter.field);return j.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Te(n.unaryFilter.field);return j.create(o,"!=",{nullValue:"NULL_VALUE"});default:return I()}}(e):e.fieldFilter!==void 0?function(n){return j.create(Te(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return I()}}(n.fieldFilter.op),n.fieldFilter.value)}(e):e.compositeFilter!==void 0?function(n){return St.create(n.compositeFilter.filters.map(r=>Al(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return I()}}(n.compositeFilter.op))}(e):I()}function sm(e){return Qf[e]}function om(e){return Wf[e]}function am(e){return Hf[e]}function Ie(e){return{fieldPath:e.canonicalString()}}function Te(e){return at.fromServerFormat(e.fieldPath)}function Sl(e){return e instanceof j?function(n){if(n.op==="=="){if(Pu(n.value))return{unaryFilter:{field:Ie(n.field),op:"IS_NAN"}};if(Ru(n.value))return{unaryFilter:{field:Ie(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Pu(n.value))return{unaryFilter:{field:Ie(n.field),op:"IS_NOT_NAN"}};if(Ru(n.value))return{unaryFilter:{field:Ie(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ie(n.field),op:om(n.op),value:n.value}}}(e):e instanceof St?function(n){let r=n.getFilters().map(i=>Sl(i));return r.length===1?r[0]:{compositeFilter:{op:am(n.op),filters:r}}}(e):I()}function cm(e){let t=[];return e.fields.forEach(n=>t.push(n.canonicalString())),{fieldPaths:t}}function bl(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}var xn=class e{constructor(t,n,r,i,s=b.min(),o=b.min(),a=nt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var go=class{constructor(t){this.ct=t}};function um(e){let t=rm({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?to(t,t.limit,"L"):t}var zr=class{constructor(){}Pt(t,n){this.It(t,n),n.Tt()}It(t,n){if("nullValue"in t)this.Et(n,5);else if("booleanValue"in t)this.Et(n,10),n.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(n,15),n.dt(L(t.integerValue));else if("doubleValue"in t){let r=L(t.doubleValue);isNaN(r)?this.Et(n,13):(this.Et(n,15),bn(r)?n.dt(0):n.dt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Et(n,20),typeof r=="string"?n.At(r):(n.At(`${r.seconds||""}`),n.dt(r.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,n),this.Vt(n);else if("bytesValue"in t)this.Et(n,30),n.ft(Ut(t.bytesValue)),this.Vt(n);else if("referenceValue"in t)this.gt(t.referenceValue,n);else if("geoPointValue"in t){let r=t.geoPointValue;this.Et(n,45),n.dt(r.latitude||0),n.dt(r.longitude||0)}else"mapValue"in t?Zu(t)?this.Et(n,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,n),this.Vt(n)):"arrayValue"in t?(this.wt(t.arrayValue,n),this.Vt(n)):I()}Rt(t,n){this.Et(n,25),this.St(t,n)}St(t,n){n.At(t)}yt(t,n){let r=t.fields||{};this.Et(n,55);for(let i of Object.keys(r))this.Rt(i,n),this.It(r[i],n)}wt(t,n){let r=t.values||[];this.Et(n,50);for(let i of r)this.It(i,n)}gt(t,n){this.Et(n,37),E.fromName(t).path.forEach(r=>{this.Et(n,60),this.St(r,n)})}Et(t,n){t.dt(n)}Vt(t){t.dt(2)}};zr.bt=new zr;var po=class{constructor(){this._n=new _o}addToCollectionParentIndex(t,n){return this._n.add(n),g.resolve()}getCollectionParents(t,n){return g.resolve(this._n.getEntries(n))}addFieldIndex(t,n){return g.resolve()}deleteFieldIndex(t,n){return g.resolve()}deleteAllFieldIndexes(t){return g.resolve()}createTargetIndexes(t,n){return g.resolve()}getDocumentsMatchingTarget(t,n){return g.resolve(null)}getIndexType(t,n){return g.resolve(0)}getFieldIndexes(t,n){return g.resolve([])}getNextCollectionGroupToUpdate(t){return g.resolve(null)}getMinOffset(t,n){return g.resolve(se.min())}getMinOffsetFromCollectionGroup(t,n){return g.resolve(se.min())}updateCollectionGroup(t,n,r){return g.resolve()}updateIndexEntries(t,n){return g.resolve()}},_o=class{constructor(){this.index={}}add(t){let n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new tt(F.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(t){let n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(t){return(this.index[t]||new tt(F.comparator)).toArray()}};var zg=new Uint8Array(0);var wt=class e{constructor(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};wt.DEFAULT_COLLECTION_PERCENTILE=10,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wt.DEFAULT=new wt(41943040,wt.DEFAULT_COLLECTION_PERCENTILE,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wt.DISABLED=new wt(-1,0,0);var Vn=class e{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new e(0)}static Bn(){return new e(-1)}};var yo=class{constructor(){this.changes=new zt(t=>t.toString(),(t,n)=>t.isEqual(n)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,n){this.assertNotApplied(),this.changes.set(t,mt.newInvalidDocument(t).setReadTime(n))}getEntry(t,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?g.resolve(r):this.getFromCache(t,n)}getEntries(t,n){return this.getAllFromCache(t,n)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var wo=class{constructor(t,n){this.overlayedDocument=t,this.mutatedFields=n}};var vo=class{constructor(t,n,r,i){this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,n))).next(i=>(r!==null&&Sn(r.mutation,i,lt.empty(),Y.now()),i))}getDocuments(t,n){return this.remoteDocumentCache.getEntries(t,n).next(r=>this.getLocalViewOfDocuments(t,r,P()).next(()=>r))}getLocalViewOfDocuments(t,n,r=P()){let i=te();return this.populateOverlays(t,i,n).next(()=>this.computeViews(t,n,i,r).next(s=>{let o=En();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,n){let r=te();return this.populateOverlays(t,r,n).next(()=>this.computeViews(t,n,r,P()))}populateOverlays(t,n,r){let i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(t,n,r,i){let s=Nt(),o=An(),a=function(){return An()}();return n.forEach((c,u)=>{let l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof bt)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),Sn(l.mutation,u,l.mutation.getFieldMask(),Y.now())):o.set(u.key,lt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),n.forEach((u,l)=>{var h;return a.set(u,new wo(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,n){let r=An(),i=new B((o,a)=>o-a),s=P();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,n).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=n.get(c);if(u===null)return;let l=r.get(c)||lt.empty();l=a.applyToLocalView(u,l),r.set(c,l);let h=(i.get(a.batchId)||P()).add(c);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,h=ll();l.forEach(d=>{if(!s.has(d)){let m=_l(n.get(d),r.get(d));m!==null&&h.set(d,m),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,u,h))}return g.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,n){return this.remoteDocumentCache.getEntries(t,n).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,n,r,i){return function(o){return E.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(t,n.path):Cf(n)?this.getDocumentsMatchingCollectionGroupQuery(t,n,r,i):this.getDocumentsMatchingCollectionQuery(t,n,r,i)}getNextDocuments(t,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,n,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,n,r.largestBatchId,i-s.size):g.resolve(te()),a=-1,c=s;return o.next(u=>g.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?g.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{c=c.insert(l,d)}))).next(()=>this.populateOverlays(t,u,s)).next(()=>this.computeViews(t,c,u,P())).next(l=>({batchId:a,changes:ul(l)})))})}getDocumentsMatchingDocumentQuery(t,n){return this.getDocument(t,new E(n)).next(r=>{let i=En();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,n,r,i){let s=n.collectionGroup,o=En();return this.indexManager.getCollectionParents(t,s).next(a=>g.forEach(a,c=>{let u=function(h,d){return new Ne(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,u,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,r,s,i))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,mt.newInvalidDocument(l)))});let a=En();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&Sn(l.mutation,u,lt.empty(),Y.now()),hi(n,u)&&(a=a.insert(c,u))}),a})}};var Eo=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,n){return g.resolve(this.cr.get(n))}saveBundleMetadata(t,n){return this.cr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:It(i.createTime)}}(n)),g.resolve()}getNamedQuery(t,n){return g.resolve(this.lr.get(n))}saveNamedQuery(t,n){return this.lr.set(n.name,function(i){return{name:i.name,query:um(i.bundledQuery),readTime:It(i.readTime)}}(n)),g.resolve()}};var Io=class{constructor(){this.overlays=new B(E.comparator),this.hr=new Map}getOverlay(t,n){return g.resolve(this.overlays.get(n))}getOverlays(t,n){let r=te();return g.forEach(n,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,n,r){return r.forEach((i,s)=>{this.ht(t,n,s)}),g.resolve()}removeOverlaysForBatchId(t,n,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),g.resolve()}getOverlaysForCollection(t,n,r){let i=te(),s=n.length+1,o=new E(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return g.resolve(i)}getOverlaysForCollectionGroup(t,n,r,i){let s=new B((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=te(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=te(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return g.resolve(a)}ht(t,n,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new so(n,r));let s=this.hr.get(n);s===void 0&&(s=P(),this.hr.set(n,s)),this.hr.set(n,s.add(r.key))}};var Nn=class{constructor(){this.Pr=new tt(z.Ir),this.Tr=new tt(z.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,n){let r=new z(t,n);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(t,n){t.forEach(r=>this.addReference(r,n))}removeReference(t,n){this.Ar(new z(t,n))}Rr(t,n){t.forEach(r=>this.removeReference(r,n))}Vr(t){let n=new E(new F([])),r=new z(n,t),i=new z(n,t+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let n=new E(new F([])),r=new z(n,t),i=new z(n,t+1),s=P();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let n=new z(t,0),r=this.Pr.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)}},z=class{constructor(t,n){this.key=t,this.pr=n}static Ir(t,n){return E.comparator(t.key,n.key)||x(t.pr,n.pr)}static Er(t,n){return x(t.pr,n.pr)||E.comparator(t.key,n.key)}};var To=class{constructor(t,n){this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new tt(z.Ir)}checkEmpty(t){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(t,n,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ro(s,n,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new z(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(t,n){return g.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(t,n){let r=n+1,i=this.br(r),s=i<0?0:i;return g.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,n){let r=new z(n,0),i=new z(n,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),g.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,n){let r=new tt(x);return n.forEach(i=>{let s=new z(i,0),o=new z(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),g.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(t,n){let r=n.path,i=r.length+1,s=r;E.isDocumentKey(s)||(s=s.child(""));let o=new z(new E(s),0),a=new tt(x);return this.wr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.pr)),!0)},o),g.resolve(this.Dr(a))}Dr(t){let n=[];return t.forEach(r=>{let i=this.Sr(r);i!==null&&n.push(i)}),n}removeMutationBatch(t,n){N(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return g.forEach(n.mutations,i=>{let s=new z(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.wr=r})}Mn(t){}containsKey(t,n){let r=new z(n,0),i=this.wr.firstAfterOrEqual(r);return g.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,g.resolve()}Cr(t,n){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let n=this.br(t);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var Ao=class{constructor(t){this.vr=t,this.docs=function(){return new B(E.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,n){let r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)}getEntry(t,n){let r=this.docs.get(n);return g.resolve(r?r.document.mutableCopy():mt.newInvalidDocument(n))}getEntries(t,n){let r=Nt();return n.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():mt.newInvalidDocument(i))}),g.resolve(r)}getDocumentsMatchingQuery(t,n,r,i){let s=Nt(),o=n.path,a=new E(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||wf(yf(l),r)<=0||(i.has(l.key)||hi(n,l))&&(s=s.insert(l.key,l.mutableCopy()))}return g.resolve(s)}getAllFromCollectionGroup(t,n,r,i){I()}Fr(t,n){return g.forEach(this.docs,r=>n(r))}newChangeBuffer(t){return new So(this)}getSize(t){return g.resolve(this.size)}},So=class extends yo{constructor(t){super(),this.ar=t}applyChanges(t){let n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.ar.addEntry(t,i)):this.ar.removeEntry(r)}),g.waitFor(n)}getFromCache(t,n){return this.ar.getEntry(t,n)}getAllFromCache(t,n){return this.ar.getEntries(t,n)}};var bo=class{constructor(t){this.persistence=t,this.Mr=new zt(n=>fa(n),ma),this.lastRemoteSnapshotVersion=b.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Nn,this.targetCount=0,this.Br=Vn.Nn()}forEachTarget(t,n){return this.Mr.forEach((r,i)=>n(i)),g.resolve()}getLastRemoteSnapshotVersion(t){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return g.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Or&&(this.Or=n),g.resolve()}qn(t){this.Mr.set(t.target,t);let n=t.targetId;n>this.highestTargetId&&(this.Br=new Vn(n),this.highestTargetId=n),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,n){return this.qn(n),this.targetCount+=1,g.resolve()}updateTargetData(t,n){return this.qn(n),g.resolve()}removeTargetData(t,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,g.resolve()}removeTargets(t,n,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),g.waitFor(s).next(()=>i)}getTargetCount(t){return g.resolve(this.targetCount)}getTargetData(t,n){let r=this.Mr.get(n)||null;return g.resolve(r)}addMatchingKeys(t,n,r){return this.Nr.dr(n,r),g.resolve()}removeMatchingKeys(t,n,r){this.Nr.Rr(n,r);let i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),g.waitFor(s)}removeMatchingKeysForTargetId(t,n){return this.Nr.Vr(n),g.resolve()}getMatchingKeysForTargetId(t,n){let r=this.Nr.gr(n);return g.resolve(r)}containsKey(t,n){return g.resolve(this.Nr.containsKey(n))}};var Ro=class{constructor(t,n){this.Lr={},this.overlays={},this.kr=new Xu(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new bo(this),this.indexManager=new po,this.remoteDocumentCache=function(i){return new Ao(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new go(n),this.$r=new Eo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let n=this.overlays[t.toKey()];return n||(n=new Io,this.overlays[t.toKey()]=n),n}getMutationQueue(t,n){let r=this.Lr[t.toKey()];return r||(r=new To(n,this.referenceDelegate),this.Lr[t.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,n,r){y("MemoryPersistence","Starting transaction:",t);let i=new Po(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(t,n){return g.or(Object.values(this.Lr).map(r=>()=>r.containsKey(t,n)))}},Po=class extends Ls{constructor(t){super(),this.currentSequenceNumber=t}},Co=class e{constructor(t){this.persistence=t,this.zr=new Nn,this.jr=null}static Hr(t){return new e(t)}get Jr(){if(this.jr)return this.jr;throw I()}addReference(t,n,r){return this.zr.addReference(r,n),this.Jr.delete(r.toString()),g.resolve()}removeReference(t,n,r){return this.zr.removeReference(r,n),this.Jr.add(r.toString()),g.resolve()}markPotentiallyOrphaned(t,n){return this.Jr.add(n.toString()),g.resolve()}removeTarget(t,n){this.zr.Vr(n.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,n.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(t,n))}Ur(){this.jr=new Set}Wr(t){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Jr,r=>{let i=E.fromPath(r);return this.Yr(t,i).next(s=>{s||n.removeEntry(i,b.min())})}).next(()=>(this.jr=null,n.apply(t)))}updateLimboDocument(t,n){return this.Yr(t,n).next(r=>{r?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(t){return 0}Yr(t,n){return g.or([()=>g.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(t,n),()=>this.persistence.Gr(t,n)])}};var Do=class e{constructor(t,n,r,i){this.targetId=t,this.fromCache=n,this.qi=r,this.Qi=i}static Ki(t,n){let r=P(),i=P();for(let s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new e(t,n.fromCache,r,i)}};var xo=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Vo=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Fa()?8:Vr.v(Ke())>0?6:4}()}initialize(t,n){this.zi=t,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(t,n,r,i){let s={result:null};return this.ji(t,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(t,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new xo;return this.Ji(t,n,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(t,n,o,a.size)})}).next(()=>s.result)}Yi(t,n,r,i){return r.documentReadCount<this.Wi?(vn()<=D.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",Ee(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),g.resolve()):(vn()<=D.DEBUG&&y("QueryEngine","Query:",Ee(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(vn()<=D.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",Ee(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Et(n))):g.resolve())}ji(t,n){if(Vu(n))return g.resolve(null);let r=Et(n);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=to(n,null,"F"),r=Et(n)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=P(...s);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(c=>{let u=this.Zi(n,a);return this.Xi(n,u,o,c.readTime)?this.ji(t,to(n,null,"F")):this.es(t,u,n,c)}))})))}Hi(t,n,r,i){return Vu(n)||i.isEqual(b.min())?g.resolve(null):this.zi.getDocuments(t,r).next(s=>{let o=this.Zi(n,s);return this.Xi(n,o,r,i)?g.resolve(null):(vn()<=D.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ee(n)),this.es(t,o,n,_f(i,-1)).next(a=>a))})}Zi(t,n){let r=new tt(al(t));return n.forEach((i,s)=>{hi(t,s)&&(r=r.add(s))}),r}Xi(t,n,r,i){if(t.limit===null)return!1;if(r.size!==n.size)return!0;let s=t.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(t,n,r){return vn()<=D.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",Ee(n)),this.zi.getDocumentsMatchingQuery(t,n,se.min(),r)}es(t,n,r,i){return this.zi.getDocumentsMatchingQuery(t,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}};var No=class{constructor(t,n,r,i){this.persistence=t,this.ts=n,this.serializer=i,this.ns=new B(x),this.rs=new zt(s=>fa(s),ma),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new vo(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>t.collect(n,this.ns))}};function lm(e,t,n,r){return new No(e,t,n,r)}function Rl(e,t){return p(this,null,function*(){let n=R(e);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n._s(t),n.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=P();for(let u of i){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return n.localDocuments.getDocuments(r,c).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function hm(e,t){let n=R(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){let h=u.batch,d=h.keys(),m=g.resolve();return d.forEach(A=>{m=m.next(()=>l.getEntry(c,A)).next(S=>{let v=u.docVersions.get(A);N(v!==null),S.version.compareTo(v)<0&&(h.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),l.addEntry(S)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(n,r,t,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=P();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(t))).next(()=>n.localDocuments.getDocuments(r,i))})}function Pl(e){let t=R(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",n=>t.Qr.getLastRemoteSnapshotVersion(n))}function dm(e,t){let n=R(e),r=t.snapshotVersion,i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;let a=[];t.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(n.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>n.Qr.addMatchingKeys(s,l.addedDocuments,h)));let m=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?m=m.withResumeToken(nt.EMPTY_BYTE_STRING,b.min()).withLastLimboFreeSnapshotVersion(b.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),function(S,v,k){return S.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0}(d,m,l)&&a.push(n.Qr.updateTargetData(s,m))});let c=Nt(),u=P();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(fm(s,o,t.documentUpdates).next(l=>{c=l.cs,u=l.ls})),!r.isEqual(b.min())){let l=n.Qr.getLastRemoteSnapshotVersion(s).next(h=>n.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return g.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(n.ns=i,s))}function fm(e,t,n){let r=P(),i=P();return n.forEach(s=>r=r.add(s)),t.getEntries(e,r).next(s=>{let o=Nt();return n.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(b.min())?(t.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(t.addEntry(c),o=o.insert(a,c)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{cs:o,ls:i}})}function mm(e,t){let n=R(e);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function gm(e,t){let n=R(e);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Qr.getTargetData(r,t).next(s=>s?(i=s,g.resolve(i)):n.Qr.allocateTargetId(r).next(o=>(i=new xn(t,o,"TargetPurposeListen",r.currentSequenceNumber),n.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=n.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ns=n.ns.insert(r.targetId,r),n.rs.set(t,r.targetId)),r})}function ko(e,t,n){return p(this,null,function*(){let r=R(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Fn(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)})}function ju(e,t,n){let r=R(e),i=b.min(),s=P();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){let h=R(c),d=h.rs.get(l);return d!==void 0?g.resolve(h.ns.get(d)):h.Qr.getTargetData(u,l)}(r,o,Et(t)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ts.getDocumentsMatchingQuery(o,t,n?i:b.min(),n?s:P())).next(a=>(pm(r,xf(t),a),{documents:a,hs:s})))}function pm(e,t,n){let r=e.ss.get(t)||b.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),e.ss.set(t,r)}var jr=class{constructor(){this.activeTargetIds=Lf()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Oo=class{constructor(){this.no=new jr,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,n,r){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,n,r){this.ro[t]=n}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new jr,Promise.resolve()}handleUserChange(t,n,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Mo=class{io(t){}shutdown(){}};var Gr=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var br=null;function bs(){return br===null?br=function(){return 268435456+Math.round(2147483648*Math.random())}():br++,"0x"+br.toString(16)}var _m={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Lo=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var Z="WebChannelConnection",Fo=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+n.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(n,r,i,s,o){let a=bs(),c=this.bo(n,r.toUriEncodedString());y("RestConnection",`Sending RPC '${n}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,s,o),this.Co(n,c,u,i).then(l=>(y("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw Re("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}vo(n,r,i,s,o,a){return this.So(n,r,i,s,o)}Do(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ue}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}bo(n,r){let i=_m[n];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,n,r,i){let s=bs();return new Promise((o,a)=>{let c=new Eu;c.setWithCredentials(!0),c.listenOnce(wu.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ar.NO_ERROR:let l=c.getResponseJson();y(Z,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case Ar.TIMEOUT:y(Z,`RPC '${t}' ${s} timed out`),a(new w(f.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:let h=c.getStatus();if(y(Z,`RPC '${t}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);let m=d?.error;if(m&&m.status&&m.message){let A=function(v){let k=v.toLowerCase().replace(/_/g,"-");return Object.values(f).indexOf(k)>=0?k:f.UNKNOWN}(m.status);a(new w(A,m.message))}else a(new w(f.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new w(f.UNAVAILABLE,"Connection failed."));break;default:I()}}finally{y(Z,`RPC '${t}' ${s} completed.`)}});let u=JSON.stringify(i);y(Z,`RPC '${t}' ${s} sending request:`,i),c.send(n,"POST",u,r,15)})}Fo(t,n,r){let i=bs(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=_u(),a=yu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;let l=s.join("");y(Z,`Creating RPC '${t}' stream ${i}: ${l}`,c);let h=o.createWebChannel(l,c),d=!1,m=!1,A=new Lo({lo:v=>{m?y(Z,`Not sending because RPC '${t}' stream ${i} is closed:`,v):(d||(y(Z,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),y(Z,`RPC '${t}' stream ${i} sending:`,v),h.send(v))},ho:()=>h.close()}),S=(v,k,q)=>{v.listen(k,Q=>{try{q(Q)}catch(it){setTimeout(()=>{throw it},0)}})};return S(h,wn.EventType.OPEN,()=>{m||y(Z,`RPC '${t}' stream ${i} transport opened.`)}),S(h,wn.EventType.CLOSE,()=>{m||(m=!0,y(Z,`RPC '${t}' stream ${i} transport closed`),A.Vo())}),S(h,wn.EventType.ERROR,v=>{m||(m=!0,Re(Z,`RPC '${t}' stream ${i} transport errored:`,v),A.Vo(new w(f.UNAVAILABLE,"The operation could not be completed")))}),S(h,wn.EventType.MESSAGE,v=>{var k;if(!m){let q=v.data[0];N(!!q);let Q=q,it=Q.error||((k=Q[0])===null||k===void 0?void 0:k.error);if(it){y(Z,`RPC '${t}' stream ${i} received error:`,it);let $t=it.status,rt=function(sh){let Ca=U[sh];if(Ca!==void 0)return wl(Ca)}($t),de=it.message;rt===void 0&&(rt=f.INTERNAL,de="Unknown error status: "+$t+" with message "+it.message),m=!0,A.Vo(new w(rt,de)),h.close()}else y(Z,`RPC '${t}' stream ${i} received:`,q),A.mo(q)}}),S(a,vu.STAT_EVENT,v=>{v.stat===As.PROXY?y(Z,`RPC '${t}' stream ${i} detected buffering proxy`):v.stat===As.NOPROXY&&y(Z,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{A.Ro()},0),A}};function Rs(){return typeof document<"u"?document:null}function di(e){return new uo(e,!0)}var $r=class{constructor(t,n,r=1e3,i=1.5,s=6e4){this.oi=t,this.timerId=n,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,n-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}};var Kr=class{constructor(t,n,r,i,s,o,a,c){this.oi=t,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new $r(t,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return p(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return p(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,n){return p(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():n&&n.code===f.RESOURCE_EXHAUSTED?(Tt(n.toString()),Tt("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===f.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(n)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===n&&this.o_(r,i)},r=>{t(()=>{let i=new w(f.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(t,n){let r=this.s_(this.Wo);this.stream=this.a_(t,n),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>p(this,null,function*(){this.state=0,this.start()}))}__(t){return y("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return n=>{this.oi.enqueueAndForget(()=>this.Wo===t?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Bo=class extends Kr{constructor(t,n,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}a_(t,n){return this.connection.Fo("Listen",t,n)}onMessage(t){this.jo.reset();let n=Jf(this.serializer,t),r=function(s){if(!("targetChange"in s))return b.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?b.min():o.readTime?It(o.readTime):b.min()}(t);return this.listener.u_(n,r)}c_(t){let n={};n.database=mo(this.serializer),n.addTarget=function(s,o){let a,c=o.target;if(a=Zs(c)?{documents:em(s,c)}:{query:nm(s,c).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=vl(s,o.resumeToken);let u=lo(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(b.min())>0){a.readTime=Ur(s,o.snapshotVersion.toTimestamp());let u=lo(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,t);let r=im(this.serializer,t);r&&(n.labels=r),this.t_(n)}l_(t){let n={};n.database=mo(this.serializer),n.removeTarget=t,this.t_(n)}},qo=class extends Kr{constructor(t,n,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,n){return this.connection.Fo("Write",t,n)}onMessage(t){if(N(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let n=tm(t.writeResults,t.commitTime),r=It(t.commitTime);return this.listener.T_(r,n)}return N(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=mo(this.serializer),this.t_(t)}I_(t){let n={streamToken:this.lastStreamToken,writes:t.map(r=>Zf(this.serializer,r))};this.t_(n)}};var Uo=class extends class{}{constructor(t,n,r,i){super(),this.authCredentials=t,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new w(f.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(t,ho(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new w(f.UNKNOWN,s.toString())})}vo(t,n,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,ho(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new w(f.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var zo=class{constructor(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let n=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Tt(n),this.g_=!1):y("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var jo=class{constructor(t,n,r,i,s){this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>p(this,null,function*(){he(this)&&(y("RemoteStore","Restarting streams for network reachability change."),yield function(c){return p(this,null,function*(){let u=R(c);u.v_.add(4),yield Bn(u),u.x_.set("Unknown"),u.v_.delete(4),yield fi(u)})}(this))}))}),this.x_=new zo(r,i)}};function fi(e){return p(this,null,function*(){if(he(e))for(let t of e.F_)yield t(!0)})}function Bn(e){return p(this,null,function*(){for(let t of e.F_)yield t(!1)})}function Cl(e,t){let n=R(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),wa(n)?ya(n):ze(n).Jo()&&_a(n,t))}function Dl(e,t){let n=R(e),r=ze(n);n.C_.delete(t),r.Jo()&&xl(n,t),n.C_.size===0&&(r.Jo()?r.Xo():he(n)&&n.x_.set("Unknown"))}function _a(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(b.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ze(e).c_(t)}function xl(e,t){e.O_.Oe(t),ze(e).l_(t)}function ya(e){e.O_=new co({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),ze(e).start(),e.x_.p_()}function wa(e){return he(e)&&!ze(e).Ho()&&e.C_.size>0}function he(e){return R(e).v_.size===0}function Vl(e){e.O_=void 0}function ym(e){return p(this,null,function*(){e.C_.forEach((t,n)=>{_a(e,t)})})}function wm(e,t){return p(this,null,function*(){Vl(e),wa(e)?(e.x_.S_(t),ya(e)):e.x_.set("Unknown")})}function vm(e,t,n){return p(this,null,function*(){if(e.x_.set("Online"),t instanceof Br&&t.state===2&&t.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(e,t)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Qr(e,r)}else if(t instanceof Se?e.O_.$e(t):t instanceof Fr?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(b.min()))try{let r=yield Pl(e.localStore);n.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let l=s.C_.get(u);l&&s.C_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let l=s.C_.get(c);if(!l)return;s.C_.set(c,l.withResumeToken(nt.EMPTY_BYTE_STRING,l.snapshotVersion)),xl(s,c);let h=new xn(l.target,c,u,l.sequenceNumber);_a(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(e,n))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield Qr(e,r)}})}function Qr(e,t,n){return p(this,null,function*(){if(!Fn(t))throw t;e.v_.add(1),yield Bn(e),e.x_.set("Offline"),n||(n=()=>Pl(e.localStore)),e.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){y("RemoteStore","Retrying IndexedDB access"),yield n(),e.v_.delete(1),yield fi(e)}))})}function Nl(e,t){return t().catch(n=>Qr(e,n,t))}function mi(e){return p(this,null,function*(){let t=R(e),n=jt(t),r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Em(t);)try{let i=yield mm(t.localStore,r);if(i===null){t.D_.length===0&&n.Xo();break}r=i.batchId,Im(t,i)}catch(i){yield Qr(t,i)}kl(t)&&Ol(t)})}function Em(e){return he(e)&&e.D_.length<10}function Im(e,t){e.D_.push(t);let n=jt(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function kl(e){return he(e)&&!jt(e).Ho()&&e.D_.length>0}function Ol(e){jt(e).start()}function Tm(e){return p(this,null,function*(){jt(e).d_()})}function Am(e){return p(this,null,function*(){let t=jt(e);for(let n of e.D_)t.I_(n.mutations)})}function Sm(e,t,n){return p(this,null,function*(){let r=e.D_.shift(),i=io.from(r,t,n);yield Nl(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),yield mi(e)})}function bm(e,t){return p(this,null,function*(){t&&jt(e).P_&&(yield function(r,i){return p(this,null,function*(){if(function(o){return Gf(o)&&o!==f.ABORTED}(i.code)){let s=r.D_.shift();jt(r).Zo(),yield Nl(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield mi(r)}})}(e,t)),kl(e)&&Ol(e)})}function Gu(e,t){return p(this,null,function*(){let n=R(e);n.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");let r=he(n);n.v_.add(3),yield Bn(n),r&&n.x_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),yield fi(n)})}function Rm(e,t){return p(this,null,function*(){let n=R(e);t?(n.v_.delete(2),yield fi(n)):t||(n.v_.add(2),yield Bn(n),n.x_.set("Unknown"))})}function ze(e){return e.N_||(e.N_=function(n,r,i){let s=R(n);return s.R_(),new Bo(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(e.datastore,e.asyncQueue,{Po:ym.bind(null,e),To:wm.bind(null,e),u_:vm.bind(null,e)}),e.F_.push(t=>p(this,null,function*(){t?(e.N_.Zo(),wa(e)?ya(e):e.x_.set("Unknown")):(yield e.N_.stop(),Vl(e))}))),e.N_}function jt(e){return e.B_||(e.B_=function(n,r,i){let s=R(n);return s.R_(),new qo(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(e.datastore,e.asyncQueue,{Po:Tm.bind(null,e),To:bm.bind(null,e),E_:Am.bind(null,e),T_:Sm.bind(null,e)}),e.F_.push(t=>p(this,null,function*(){t?(e.B_.Zo(),yield mi(e)):(yield e.B_.stop(),e.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}var Go=class e{constructor(t,n,r,i,s){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,i,s){let o=Date.now()+r,a=new e(t,n,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(f.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function va(e,t){if(Tt("AsyncQueue",`${t}: ${e}`),Fn(e))return new w(f.UNAVAILABLE,`${t}: ${e}`);throw e}var Wr=class e{constructor(t){this.comparator=t?(n,r)=>t(n,r)||E.comparator(n.key,r.key):(n,r)=>E.comparator(n.key,r.key),this.keyedMap=En(),this.sortedSet=new B(this.comparator)}static emptySet(t){return new e(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((n,r)=>(t(n),!1))}add(t){let n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))}delete(t){let n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(n=>{t.push(n.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,n){let r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}};var Hr=class{constructor(){this.L_=new B(E.comparator)}track(t){let n=t.doc.key,r=this.L_.get(n);r?t.type!==0&&r.type===3?this.L_=this.L_.insert(n,t):t.type===3&&r.type!==1?this.L_=this.L_.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.L_=this.L_.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.L_=this.L_.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.L_=this.L_.remove(n):t.type===1&&r.type===2?this.L_=this.L_.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.L_=this.L_.insert(n,{type:2,doc:t.doc}):I():this.L_=this.L_.insert(n,t)}k_(){let t=[];return this.L_.inorderTraversal((n,r)=>{t.push(r)}),t}},Fe=class e{constructor(t,n,r,i,s,o,a,c,u){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(t,n,r,i,s){let o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new e(t,n,Wr.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&li(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}};var $o=class{constructor(){this.q_=void 0,this.Q_=[]}},Ko=class{constructor(){this.queries=new zt(t=>ol(t),li),this.onlineState="Unknown",this.K_=new Set}};function Ml(e,t){return p(this,null,function*(){let n=R(e),r=t.query,i=!1,s=n.queries.get(r);if(s||(i=!0,s=new $o),i)try{s.q_=yield n.onListen(r)}catch(o){let a=va(o,`Initialization of query '${Ee(t.query)}' failed`);return void t.onError(a)}n.queries.set(r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_&&t.W_(s.q_)&&Ea(n)})}function Ll(e,t){return p(this,null,function*(){let n=R(e),r=t.query,i=!1,s=n.queries.get(r);if(s){let o=s.Q_.indexOf(t);o>=0&&(s.Q_.splice(o,1),i=s.Q_.length===0)}if(i)return n.queries.delete(r),n.onUnlisten(r)})}function Pm(e,t){let n=R(e),r=!1;for(let i of t){let s=i.query,o=n.queries.get(s);if(o){for(let a of o.Q_)a.W_(i)&&(r=!0);o.q_=i}}r&&Ea(n)}function Cm(e,t,n){let r=R(e),i=r.queries.get(t);if(i)for(let s of i.Q_)s.onError(n);r.queries.delete(t)}function Ea(e){e.K_.forEach(t=>{t.next()})}var Yr=class{constructor(t,n,r){this.query=t,this.G_=n,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new Fe(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let n=!1;return this.z_?this.H_(t)&&(this.G_.next(t),n=!0):this.J_(t,this.onlineState)&&(this.Y_(t),n=!0),this.j_=t,n}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let n=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),n=!0),n}J_(t,n){if(!t.fromCache)return!0;let r=n!=="Offline";return(!this.options.Z_||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||n==="Offline")}H_(t){if(t.docChanges.length>0)return!0;let n=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Y_(t){t=Fe.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}};var Xr=class{constructor(t){this.key=t}},Jr=class{constructor(t){this.key=t}},Qo=class{constructor(t,n){this.query=t,this.oa=n,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=P(),this.mutatedKeys=P(),this.ua=al(t),this.ca=new Wr(this.ua)}get la(){return this.oa}ha(t,n){let r=n?n.Pa:new Hr,i=n?n.ca:this.ca,s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((l,h)=>{let d=i.get(l),m=hi(this.query,h)?h:null,A=!!d&&this.mutatedKeys.has(d.key),S=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),v=!1;d&&m?d.data.isEqual(m.data)?A!==S&&(r.track({type:3,doc:m}),v=!0):this.Ia(d,m)||(r.track({type:2,doc:m}),v=!0,(c&&this.ua(m,c)>0||u&&this.ua(m,u)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),v=!0):d&&!m&&(r.track({type:1,doc:d}),v=!0,(c||u)&&(a=!0)),v&&(m?(o=o.add(m),s=S?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,Xi:a,mutatedKeys:s}}Ia(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(t,n,r,i){let s=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;let o=t.Pa.k_();o.sort((l,h)=>function(m,A){let S=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return I()}};return S(m)-S(A)}(l.type,h.type)||this.ua(l.doc,h.doc)),this.Ta(r),i=i!=null&&i;let a=n&&!i?this.Ea():[],c=this.aa.size===0&&this.current&&!i?1:0,u=c!==this._a;return this._a=c,o.length!==0||u?{snapshot:new Fe(this.query,t.ca,s,o,t.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Hr,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach(n=>this.oa=this.oa.add(n)),t.modifiedDocuments.forEach(n=>{}),t.removedDocuments.forEach(n=>this.oa=this.oa.delete(n)),this.current=t.current)}Ea(){if(!this.current)return[];let t=this.aa;this.aa=P(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});let n=[];return t.forEach(r=>{this.aa.has(r)||n.push(new Jr(r))}),this.aa.forEach(r=>{t.has(r)||n.push(new Xr(r))}),n}Ra(t){this.oa=t.hs,this.aa=P();let n=this.ha(t.documents);return this.applyChanges(n,!0)}Va(){return Fe.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,this._a===0,this.hasCachedResults)}},Wo=class{constructor(t,n,r){this.query=t,this.targetId=n,this.view=r}},Ho=class{constructor(t){this.key=t,this.ma=!1}},Yo=class{constructor(t,n,r,i,s,o){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new zt(a=>ol(a),li),this.pa=new Map,this.ya=new Set,this.wa=new B(E.comparator),this.Sa=new Map,this.ba=new Nn,this.Da={},this.Ca=new Map,this.va=Vn.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return this.Fa===!0}};function Dm(e,t){return p(this,null,function*(){let n=qm(e),r,i,s=n.ga.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{let o=yield gm(n.localStore,Et(t)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield xm(n,t,r,a==="current",o.resumeToken),n.isPrimaryClient&&Cl(n.remoteStore,o)}return i})}function xm(e,t,n,r,i){return p(this,null,function*(){e.Ma=(h,d,m)=>function(S,v,k,q){return p(this,null,function*(){let Q=v.view.ha(k);Q.Xi&&(Q=yield ju(S.localStore,v.query,!1).then(({documents:de})=>v.view.ha(de,Q)));let it=q&&q.targetChanges.get(v.targetId),$t=q&&q.targetMismatches.get(v.targetId)!=null,rt=v.view.applyChanges(Q,S.isPrimaryClient,it,$t);return Ku(S,v.targetId,rt.da),rt.snapshot})}(e,h,d,m);let s=yield ju(e.localStore,t,!0),o=new Qo(t,s.hs),a=o.ha(s.documents),c=Dn.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline",i),u=o.applyChanges(a,e.isPrimaryClient,c);Ku(e,n,u.da);let l=new Wo(t,n,o);return e.ga.set(t,l),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot})}function Vm(e,t){return p(this,null,function*(){let n=R(e),r=n.ga.get(t),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter(s=>!li(s,t))),void n.ga.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield ko(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Dl(n.remoteStore,r.targetId),Xo(n,r.targetId)}).catch(Ln))):(Xo(n,r.targetId),yield ko(n.localStore,r.targetId,!0))})}function Nm(e,t,n){return p(this,null,function*(){let r=Um(e);try{let i=yield function(o,a){let c=R(o),u=Y.now(),l=a.reduce((m,A)=>m.add(A.key),P()),h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",m=>{let A=Nt(),S=P();return c.os.getEntries(m,l).next(v=>{A=v,A.forEach((k,q)=>{q.isValidDocument()||(S=S.add(k))})}).next(()=>c.localDocuments.getOverlayedDocuments(m,A)).next(v=>{h=v;let k=[];for(let q of a){let Q=jf(q,h.get(q.key).overlayedDocument);Q!=null&&k.push(new bt(q.key,Q,tl(Q.value.mapValue),Vt.exists(!0)))}return c.mutationQueue.addMutationBatch(m,u,k,a)}).next(v=>{d=v;let k=v.applyToLocalDocumentSet(h,S);return c.documentOverlayCache.saveOverlays(m,v.batchId,k)})}).then(()=>({batchId:d.batchId,changes:ul(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Da[o.currentUser.toKey()];u||(u=new B(x)),u=u.insert(a,c),o.Da[o.currentUser.toKey()]=u}(r,i.batchId,n),yield qn(r,i.changes),yield mi(r.remoteStore)}catch(i){let s=va(i,"Failed to persist write");n.reject(s)}})}function Fl(e,t){return p(this,null,function*(){let n=R(e);try{let r=yield dm(n.localStore,t);t.targetChanges.forEach((i,s)=>{let o=n.Sa.get(s);o&&(N(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?N(o.ma):i.removedDocuments.size>0&&(N(o.ma),o.ma=!1))}),yield qn(n,r,t)}catch(r){yield Ln(r)}})}function $u(e,t,n){let r=R(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let i=[];r.ga.forEach((s,o)=>{let a=o.view.U_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=R(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(let d of h.Q_)d.U_(a)&&(u=!0)}),u&&Ea(c)}(r.eventManager,t),i.length&&r.fa.u_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function km(e,t,n){return p(this,null,function*(){let r=R(e);r.sharedClientState.updateQueryState(t,"rejected",n);let i=r.Sa.get(t),s=i&&i.key;if(s){let o=new B(E.comparator);o=o.insert(s,mt.newNoDocument(s,b.min()));let a=P().add(s),c=new Lr(b.min(),new Map,new B(x),o,a);yield Fl(r,c),r.wa=r.wa.remove(s),r.Sa.delete(t),Ia(r)}else yield ko(r.localStore,t,!1).then(()=>Xo(r,t,n)).catch(Ln)})}function Om(e,t){return p(this,null,function*(){let n=R(e),r=t.batch.batchId;try{let i=yield hm(n.localStore,t);ql(n,r,null),Bl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield qn(n,i)}catch(i){yield Ln(i)}})}function Mm(e,t,n){return p(this,null,function*(){let r=R(e);try{let i=yield function(o,a){let c=R(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(h=>(N(h!==null),l=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,t);ql(r,t,n),Bl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield qn(r,i)}catch(i){yield Ln(i)}})}function Bl(e,t){(e.Ca.get(t)||[]).forEach(n=>{n.resolve()}),e.Ca.delete(t)}function ql(e,t,n){let r=R(e),i=r.Da[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(n?s.reject(n):s.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function Xo(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(let r of e.pa.get(t))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach(r=>{e.ba.containsKey(r)||Ul(e,r)})}function Ul(e,t){e.ya.delete(t.path.canonicalString());let n=e.wa.get(t);n!==null&&(Dl(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),Ia(e))}function Ku(e,t,n){for(let r of n)r instanceof Xr?(e.ba.addReference(r.key,t),Lm(e,r)):r instanceof Jr?(y("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||Ul(e,r.key)):I()}function Lm(e,t){let n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(y("SyncEngine","New document in limbo: "+n),e.ya.add(r),Ia(e))}function Ia(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){let t=e.ya.values().next().value;e.ya.delete(t);let n=new E(F.fromString(t)),r=e.va.next();e.Sa.set(r,new Ho(n)),e.wa=e.wa.insert(n,r),Cl(e.remoteStore,new xn(Et(ga(n.path)),r,"TargetPurposeLimboResolution",Xu._e))}}function qn(e,t,n){return p(this,null,function*(){let r=R(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach((a,c)=>{o.push(r.Ma(c,t,n).then(u=>{if((u||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){i.push(u);let l=Do.Ki(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield function(c,u){return p(this,null,function*(){let l=R(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>g.forEach(u,d=>g.forEach(d.qi,m=>l.persistence.referenceDelegate.addReference(h,d.targetId,m)).next(()=>g.forEach(d.Qi,m=>l.persistence.referenceDelegate.removeReference(h,d.targetId,m)))))}catch(h){if(!Fn(h))throw h;y("LocalStore","Failed to update sequence numbers: "+h)}for(let h of u){let d=h.targetId;if(!h.fromCache){let m=l.ns.get(d),A=m.snapshotVersion,S=m.withLastLimboFreeSnapshotVersion(A);l.ns=l.ns.insert(d,S)}}})}(r.localStore,s))})}function Fm(e,t){return p(this,null,function*(){let n=R(e);if(!n.currentUser.isEqual(t)){y("SyncEngine","User change. New user:",t.toKey());let r=yield Rl(n.localStore,t);n.currentUser=t,function(s,o){s.Ca.forEach(a=>{a.forEach(c=>{c.reject(new w(f.CANCELLED,o))})}),s.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield qn(n,r.us)}})}function Bm(e,t){let n=R(e),r=n.Sa.get(t);if(r&&r.ma)return P().add(r.key);{let i=P(),s=n.pa.get(t);if(!s)return i;for(let o of s){let a=n.ga.get(o);i=i.unionWith(a.view.la)}return i}}function qm(e){let t=R(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Fl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bm.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=km.bind(null,t),t.fa.u_=Pm.bind(null,t.eventManager),t.fa.xa=Cm.bind(null,t.eventManager),t}function Um(e){let t=R(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Om.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Mm.bind(null,t),t}var Zr=class{constructor(){this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=di(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,n){return null}createIndexBackfillerScheduler(t,n){return null}createLocalStore(t){return lm(this.persistence,new Vo,t.initialUser,this.serializer)}createPersistence(t){return new Ro(Co.Hr,this.serializer)}createSharedClientState(t){return new Oo}terminate(){return p(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Jo=class{initialize(t,n){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$u(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Fm.bind(null,this.syncEngine),yield Rm(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Ko}()}createDatastore(t){let n=di(t.databaseInfo.databaseId),r=function(s){return new Fo(s)}(t.databaseInfo);return function(s,o,a,c){return new Uo(s,o,a,c)}(t.authCredentials,t.appCheckCredentials,r,n)}createRemoteStore(t){return function(r,i,s,o,a){return new jo(r,i,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,n=>$u(this.syncEngine,n,0),function(){return Gr.D()?new Gr:new Mo}())}createSyncEngine(t,n){return function(i,s,o,a,c,u,l){let h=new Yo(i,s,o,a,c,u);return l&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return p(this,null,function*(){var t;yield function(r){return p(this,null,function*(){let i=R(r);y("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield Bn(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};var ti=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):Tt("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,n){this.muted||setTimeout(()=>{this.muted||t(n)},0)}};var Zo=class{constructor(t,n,r,i){this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=K.UNAUTHENTICATED,this.clientId=Dr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>p(this,null,function*(){y("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(y("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new w(f.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(n){let r=va(n,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Ps(e,t){return p(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(i=>p(this,null,function*(){r.isEqual(i)||(yield Rl(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function Qu(e,t){return p(this,null,function*(){e.asyncQueue.verifyOperationInProgress();let n=yield jm(e);y("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(n,e.configuration),e.setCredentialChangeListener(r=>Gu(t.remoteStore,r)),e.setAppCheckTokenChangeListener((r,i)=>Gu(t.remoteStore,i)),e._onlineComponents=t})}function zm(e){return e.name==="FirebaseError"?e.code===f.FAILED_PRECONDITION||e.code===f.UNIMPLEMENTED:!(typeof DOMException<"u"&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}function jm(e){return p(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ps(e,e._uninitializedComponentsProvider._offline)}catch(t){let n=t;if(!zm(n))throw n;Re("Error using user provided cache. Falling back to memory cache: "+n),yield Ps(e,new Zr)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield Ps(e,new Zr);return e._offlineComponents})}function zl(e){return p(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield Qu(e,e._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield Qu(e,new Jo))),e._onlineComponents})}function Gm(e){return zl(e).then(t=>t.syncEngine)}function jl(e){return p(this,null,function*(){let t=yield zl(e),n=t.eventManager;return n.onListen=Dm.bind(null,t.syncEngine),n.onUnlisten=Vm.bind(null,t.syncEngine),n})}function $m(e,t,n={}){let r=new ht;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,c,u){let l=new ti({next:d=>{o.enqueueAndForget(()=>Ll(s,h));let m=d.docs.has(a);!m&&d.fromCache?u.reject(new w(f.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&c&&c.source==="server"?u.reject(new w(f.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new Yr(ga(a.path),l,{includeMetadataChanges:!0,Z_:!0});return Ml(s,h)}(yield jl(e),e.asyncQueue,t,n,r)})),r.promise}function Km(e,t,n={}){let r=new ht;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,c,u){let l=new ti({next:d=>{o.enqueueAndForget(()=>Ll(s,h)),d.fromCache&&c.source==="server"?u.reject(new w(f.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new Yr(a,l,{includeMetadataChanges:!0,Z_:!0});return Ml(s,h)}(yield jl(e),e.asyncQueue,t,n,r)})),r.promise}function Gl(e){let t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}var Wu=new Map;function $l(e,t,n){if(!n)throw new w(f.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Qm(e,t,n,r){if(t===!0&&r===!0)throw new w(f.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Hu(e){if(!E.isDocumentKey(e))throw new w(f.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Yu(e){if(E.isDocumentKey(e))throw new w(f.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ta(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":I()}function kt(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new w(f.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=Ta(e);throw new w(f.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}var ei=class{constructor(t){var n,r;if(t.host===void 0){if(t.ssl!==void 0)throw new w(f.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new w(f.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Qm("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gl((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new w(f.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new w(f.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new w(f.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Be=class{constructor(t,n,r,i){this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ei({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new w(f.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new w(f.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ei(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Cs;switch(r.type){case"firstParty":return new Ns(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new w(f.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=Wu.get(n);r&&(y("ComponentProvider","Removing Datastore"),Wu.delete(n),r.terminate())}(this),Promise.resolve()}};function Wm(e,t,n,r={}){var i;let s=(e=kt(e,Be))._getSettings(),o=`${t}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Re("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=K.MOCK_USER;else{a=La(r.mockUserToken,(i=e._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new w(f.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new K(u)}e._authCredentials=new Ds(new Cr(a,c))}}var ni=class e{constructor(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new e(this.firestore,t,this._query)}},ct=class e{constructor(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new e(this.firestore,t,this._key)}},Bt=class e extends ni{constructor(t,n,r){super(t,n,ga(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ct(this.firestore,null,new E(t))}withConverter(t){return new e(this.firestore,t,this._path)}};function Aa(e,t,...n){if(e=Pt(e),$l("collection","path",t),e instanceof Be){let r=F.fromString(t,...n);return Yu(r),new Bt(e,null,r)}{if(!(e instanceof ct||e instanceof Bt))throw new w(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(F.fromString(t,...n));return Yu(r),new Bt(e.firestore,null,r)}}function Un(e,t,...n){if(e=Pt(e),arguments.length===1&&(t=Dr.newId()),$l("doc","path",t),e instanceof Be){let r=F.fromString(t,...n);return Hu(r),new ct(e,null,new E(r))}{if(!(e instanceof ct||e instanceof Bt))throw new w(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(F.fromString(t,...n));return Hu(r),new ct(e.firestore,e instanceof Bt?e.converter:null,new E(r))}}var ta=class{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new $r(this,"async_queue_retry"),this._u=()=>{let n=Rs();n&&y("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};let t=Rs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;let n=Rs();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise(()=>{});let n=new ht;return this.uu(()=>this.tu&&this.su?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.eu.push(t),this.cu()))}cu(){return p(this,null,function*(){if(this.eu.length!==0){try{yield this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!Fn(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo(()=>this.cu())}})}uu(t){let n=this.Xa.then(()=>(this.iu=!0,t().catch(r=>{this.ru=r,this.iu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Tt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.iu=!1,r))));return this.Xa=n,n}enqueueAfterDelay(t,n,r){this.au(),this.ou.indexOf(t)>-1&&(n=0);let i=Go.createAndSchedule(this,t,n,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&I()}verifyOperationInProgress(){}hu(){return p(this,null,function*(){let t;do t=this.Xa,yield t;while(t!==this.Xa)})}Pu(t){for(let n of this.nu)if(n.timerId===t)return!0;return!1}Iu(t){return this.hu().then(()=>{this.nu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.nu)if(n.skipDelay(),t!=="all"&&n.timerId===t)break;return this.hu()})}Tu(t){this.ou.push(t)}lu(t){let n=this.nu.indexOf(t);this.nu.splice(n,1)}};var Gt=class extends Be{constructor(t,n,r,i){super(t,n,r,i),this.type="firestore",this._queue=function(){return new ta}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ql(this),this._firestoreClient.terminate()}};function Kl(e,t){let n=typeof e=="object"?e:Za(),r=typeof e=="string"?e:t||"(default)",i=Xa(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Ma("firestore");s&&Wm(i,...s)}return i}function Sa(e){return e._firestoreClient||Ql(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Ql(e){var t,n,r;let i=e._freezeSettings(),s=function(a,c,u,l){return new Us(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Gl(l.experimentalLongPollingOptions),l.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Zo(e._authCredentials,e._appCheckCredentials,e._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var kn=class e{constructor(t){this._byteString=t}static fromBase64String(t){try{return new e(nt.fromBase64String(t))}catch(n){throw new w(f.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(t){return new e(nt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var qe=class{constructor(...t){for(let n=0;n<t.length;++n)if(t[n].length===0)throw new w(f.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new at(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var On=class{constructor(t){this._methodName=t}};var Mn=class{constructor(t,n){if(!isFinite(t)||t<-90||t>90)throw new w(f.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new w(f.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return x(this._lat,t._lat)||x(this._long,t._long)}};var Hm=/^__.*__$/,ea=class{constructor(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}toMutation(t,n){return this.fieldMask!==null?new bt(t,this.data,this.fieldMask,n,this.fieldTransforms):new ue(t,this.data,n,this.fieldTransforms)}},ri=class{constructor(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}toMutation(t,n){return new bt(t,this.data,this.fieldMask,n,this.fieldTransforms)}};function Wl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw I()}}var na=class e{constructor(t,n,r,i,s,o){this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(t){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.Au({path:r,Vu:!1});return i.mu(t),i}fu(t){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.Au({path:r,Vu:!1});return i.Eu(),i}gu(t){return this.Au({path:void 0,Vu:!0})}pu(t){return si(t,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(t){return this.fieldMask.find(n=>t.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>t.isPrefixOf(n.field))!==void 0}Eu(){if(this.path)for(let t=0;t<this.path.length;t++)this.mu(this.path.get(t))}mu(t){if(t.length===0)throw this.pu("Document fields must not be empty");if(Wl(this.du)&&Hm.test(t))throw this.pu('Document fields cannot begin and end with "__"')}},ra=class{constructor(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||di(t)}Su(t,n,r,i=!1){return new na({du:t,methodName:n,wu:r,path:at.emptyPath(),Vu:!1,yu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Hl(e){let t=e._freezeSettings(),n=di(e._databaseId);return new ra(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Ym(e,t,n,r,i,s={}){let o=e.Su(s.merge||s.mergeFields?2:0,t,n,i);ba("Data must be an object, but it was:",o,r);let a=Yl(r,o),c,u;if(s.merge)c=new lt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=ia(t,h,n);if(!o.contains(d))throw new w(f.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Jl(l,d)||l.push(d)}c=new lt(l),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new ea(new ot(a),c,u)}var ii=class e extends On{_toFieldTransform(t){if(t.du!==2)throw t.du===1?t.pu(`${this._methodName}() can only appear at the top level of your update data`):t.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof e}};function Xm(e,t,n,r){let i=e.Su(1,t,n);ba("Data must be an object, but it was:",i,r);let s=[],o=ot.empty();le(r,(c,u)=>{let l=Ra(t,c,n);u=Pt(u);let h=i.fu(l);if(u instanceof ii)s.push(l);else{let d=gi(u,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new lt(s);return new ri(o,a,i.fieldTransforms)}function Jm(e,t,n,r,i,s){let o=e.Su(1,t,n),a=[ia(t,r,n)],c=[i];if(s.length%2!=0)throw new w(f.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(ia(t,s[d])),c.push(s[d+1]);let u=[],l=ot.empty();for(let d=a.length-1;d>=0;--d)if(!Jl(u,a[d])){let m=a[d],A=c[d];A=Pt(A);let S=o.fu(m);if(A instanceof ii)u.push(m);else{let v=gi(A,S);v!=null&&(u.push(m),l.set(m,v))}}let h=new lt(u);return new ri(l,h,o.fieldTransforms)}function gi(e,t){if(Xl(e=Pt(e)))return ba("Unsupported field value:",t,e),Yl(e,t);if(e instanceof On)return function(r,i){if(!Wl(i.du))throw i.pu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.pu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&t.du!==4)throw t.pu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=gi(a,i.gu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(e,t)}return function(r,i){if((r=Pt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Ff(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Y.fromDate(r);return{timestampValue:Ur(i.serializer,s)}}if(r instanceof Y){let s=new Y(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ur(i.serializer,s)}}if(r instanceof Mn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof kn)return{bytesValue:vl(i.serializer,r._byteString)};if(r instanceof ct){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:pa(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.pu(`Unsupported field value: ${Ta(r)}`)}(e,t)}function Yl(e,t){let n={};return Ju(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):le(e,(r,i)=>{let s=gi(i,t.Ru(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Xl(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof Y||e instanceof Mn||e instanceof kn||e instanceof ct||e instanceof On)}function ba(e,t,n){if(!Xl(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){let r=Ta(n);throw r==="an object"?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function ia(e,t,n){if((t=Pt(t))instanceof qe)return t._internalPath;if(typeof t=="string")return Ra(e,t);throw si("Field path arguments must be of type string or ",e,!1,void 0,n)}var Zm=new RegExp("[~\\*/\\[\\]]");function Ra(e,t,n){if(t.search(Zm)>=0)throw si(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new qe(...t.split("."))._internalPath}catch{throw si(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function si(e,t,n,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new w(f.INVALID_ARGUMENT,a+e+c)}function Jl(e,t){return e.some(n=>n.isEqual(t))}var oi=class{constructor(t,n,r,i,s){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new sa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let n=this._document.data.field(Zl("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}}},sa=class extends oi{data(){return super.data()}};function Zl(e,t){return typeof t=="string"?Ra(e,t):t instanceof qe?t._internalPath:t._delegate._internalPath}function tg(e){if(e.limitType==="L"&&e.explicitOrderBy.length===0)throw new w(f.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var oa=class{convertValue(t,n="none"){switch(oe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return L(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(Ut(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw I()}}convertObject(t,n){return this.convertObjectMap(t.fields,n)}convertObjectMap(t,n="none"){let r={};return le(t,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(t){return new Mn(L(t.latitude),L(t.longitude))}convertArray(t,n){return(t.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(t,n){switch(n){case"previous":let r=ha(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Rn(t));default:return null}}convertTimestamp(t){let n=qt(t);return new Y(n.seconds,n.nanos)}convertDocumentKey(t,n){let r=F.fromString(t);N(bl(r));let i=new Or(r.get(1),r.get(3)),s=new E(r.popFirst(5));return i.isEqual(n)||Tt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}};function eg(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}var ne=class{constructor(t,n){this.hasPendingWrites=t,this.fromCache=n}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},ai=class extends oi{constructor(t,n,r,i,s,o){super(t,n,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let n=new be(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,n={}){if(this._document){let r=this._document.data.field(Zl("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},be=class extends ai{data(t={}){return super.data(t)}},aa=class{constructor(t,n,r,i){this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new ne(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(n=>t.push(n)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,n){this._snapshot.docs.forEach(r=>{t.call(n,new be(this._firestore,this._userDataWriter,r.key,r,new ne(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(f.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new be(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ne(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new be(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ne(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:ng(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function ng(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return I()}}function th(e){e=kt(e,ct);let t=kt(e.firestore,Gt);return $m(Sa(t),e._key).then(n=>rg(t,e,n))}var ci=class extends oa{constructor(t){super(),this.firestore=t}convertBytes(t){return new kn(t)}convertReference(t){let n=this.convertDocumentKey(t,this.firestore._databaseId);return new ct(this.firestore,null,n)}};function eh(e){e=kt(e,ni);let t=kt(e.firestore,Gt),n=Sa(t),r=new ci(t);return tg(e._query),Km(n,e._query).then(i=>new aa(t,r,e,i))}function nh(e,t,n,...r){e=kt(e,ct);let i=kt(e.firestore,Gt),s=Hl(i),o;return o=typeof(t=Pt(t))=="string"||t instanceof qe?Jm(s,"updateDoc",e._key,t,n,r):Xm(s,"updateDoc",e._key,t),Pa(i,[o.toMutation(e._key,Vt.exists(!0))])}function rh(e){return Pa(kt(e.firestore,Gt),[new Cn(e._key,Vt.none())])}function ih(e,t){let n=kt(e.firestore,Gt),r=Un(e),i=eg(e.converter,t);return Pa(n,[Ym(Hl(e.firestore),"addDoc",r._key,i,e.converter!==null,{}).toMutation(r._key,Vt.exists(!1))]).then(()=>r)}function Pa(e,t){return function(r,i){let s=new ht;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Nm(yield Gm(r),i,s)})),s.promise}(Sa(e),t)}function rg(e,t,n){let r=n.docs.get(t._key),i=new ci(e);return new ai(e,i,t._key,r,new ne(n.hasPendingWrites,n.fromCache),t.converter)}(function(t,n=!0){(function(i){Ue=i})(Ja),We(new Ct("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Gt(new xs(r.getProvider("auth-internal")),new Os(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new w(f.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Or(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Mt(Tu,"4.4.2",t),Mt(Tu,"4.4.2","esm2017")})();var je={toFirestore:e=>({images:e.images,ingredients:e.ingredients.map(t=>({unit:t.unit,amount:t.amount,name:t.name,icon:t.icon?t.icon:""})),instructions:e.instructions,minutes:e.minutes,name:e.name}),fromFirestore:e=>{let t=e.data();return{id:e.id,images:t.images,ingredients:t.ingredients.map(n=>({unit:n.unit,amount:n.amount,name:n.name,icon:n.icon})),instructions:t.instructions,minutes:t.minutes,name:t.name}}};var tp=(()=>{let t=class t{constructor(){let r={apiKey:"AIzaSyBbEu6Xmj7uqCUvg7KiSuczU0DXvOm8YRI",authDomain:"recetario-de-la-mama.firebaseapp.com",projectId:"recetario-de-la-mama",storageBucket:"recetario-de-la-mama.appspot.com",messagingSenderId:"674687883908",appId:"1:674687883908:web:f8fed4b9131bdf823a40d1",measurementId:"G-82Y1H8QSXQ"};this.app=ki(r),this.firestore=Kl(this.app)}getAllRecipes(){let r=Aa(this.firestore,"recipes").withConverter(je);return fe(eh(r)).pipe(pi(i=>i.docs.map(s=>s.data())))}getRecipeById(r){let i=Un(this.firestore,"recipes",r).withConverter(je);return fe(th(i)).pipe(pi(s=>{if(s.exists())return s.data();throw new Error("The requested recipe was not found")}))}addRecipe(r){let i=Aa(this.firestore,"recipes").withConverter(je);return fe(ih(i,r))}updateRecipe(r){let i=Un(this.firestore,"recipes",r.id).withConverter(je);return fe(nh(i,jn({},r)))}deleteRecipe(r){let i=Un(this.firestore,"recipes",r).withConverter(je);return fe(rh(i))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Gn({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var ip=(()=>{let t=class t{constructor(r){this.http=r,this._foods=[],this.http.post("https://app.fitia.app/api/get-foods/",null).subscribe(s=>{this._foods=s})}get foods(){return this._foods}set foods(r){if(!r)throw new Error("Could not retrieve the information.");this._foods=r}getFoodIconById(r){return this._foods.find(i=>i.id===r)?.iconURL}getFoodIconByName(r,i){let s=r.toLocaleUpperCase();return this._foods.find(o=>{let a=o.name.find(c=>c.language===i)?.name;return a&&a.toLocaleUpperCase().includes(s)})?.iconURL}};t.\u0275fac=function(i){return new(i||t)(xa(Va))},t.\u0275prov=Gn({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{tp as a,ip as b};
